{"title":"Threejs 导入模型","slug":"code/Threejs 导入stl模型","date":"2021-11-27T12:00:05.000Z","updated":"2023-01-03T10:44:10.509Z","comments":true,"path":"api/articles/code/Threejs 导入stl模型.json","excerpt":null,"covers":null,"content":"<h2 id=\"效果展示\"><a href=\"#效果展示\" class=\"headerlink\" title=\"效果展示\"></a>效果展示</h2><iframe id=\"modelFrame\" src=\"https://ts.undf.top/3d/bysj.html\" width=\"100%\" height=\"500px\" style = \"border-radius: 10px;\" frameborder=\"0\"></iframe>\n\n<h2 id=\"关于Threejs\"><a href=\"#关于Threejs\" class=\"headerlink\" title=\"关于Threejs\"></a>关于Threejs</h2><p>Three.js是基于原生WebGL封装运行的三维引擎，在所有WebGL引擎中，Three.js是国内文资料最多、使用最广泛的三维引擎。</p>\n<h2 id=\"Iframe\"><a href=\"#Iframe\" class=\"headerlink\" title=\"Iframe\"></a>Iframe</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;modelFrame&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://ts.undf.top/3d/bysj.html&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100%&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;75%&quot;</span> <span class=\"attr\">style</span> = <span class=\"string\">&quot;border-radius: 10px;&quot;</span> <span class=\"attr\">frameborder</span>=<span class=\"string\">&quot;0&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>为了方便引入，采用iframe框架，可以有效减少引入处的代码长度。</p>\n<h2 id=\"源码仓库\"><a href=\"#源码仓库\" class=\"headerlink\" title=\"源码仓库\"></a>源码仓库</h2><p><a href=\"https://github.com/wxydejoy/Test_gitpage\">点我</a></p>\n<p>仓库内3d文件夹下面即是所有源代码。如果不需要自定义修改，建议复制整个文件夹到你的目录内，如果需要自定义模型和样式，请参照下面的关键代码解释</p>\n<h2 id=\"关键代码\"><a href=\"#关键代码\" class=\"headerlink\" title=\"关键代码\"></a>关键代码</h2><p>如果需要更改js文件的位置需要修改 html 文件里面的位置和 stl.js 文件内的位置。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 如果需要修改文件位置，记得修改这里的路径</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * as THREE from <span class=\"string\">&#x27;./build/three.module.js&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> Stats from <span class=\"string\">&#x27;./build/stats.js&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; STLLoader &#125; from <span class=\"string\">&#x27;./build/stl.js&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    let container, stats;</span><br><span class=\"line\"></span><br><span class=\"line\">    let camera, cameraTarget, scene, renderer;</span><br><span class=\"line\"></span><br><span class=\"line\">    init();</span><br><span class=\"line\">    animate();</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">init</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        container = document.createElement( <span class=\"string\">&#x27;div&#x27;</span> );</span><br><span class=\"line\">        document.body.appendChild( container );</span><br><span class=\"line\"></span><br><span class=\"line\">        camera = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.PerspectiveCamera( <span class=\"number\">35</span>, window.innerWidth / window.innerHeight, <span class=\"number\">1</span>, <span class=\"number\">30</span> );</span><br><span class=\"line\">        camera.position.set( <span class=\"number\">0</span>, <span class=\"number\">0.85</span>, <span class=\"number\">0</span> );</span><br><span class=\"line\">        <span class=\"comment\">//相机位置</span></span><br><span class=\"line\">        cameraTarget = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Vector3( <span class=\"number\">0</span>, - <span class=\"number\">0.25</span>, <span class=\"number\">0</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        scene = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Scene();</span><br><span class=\"line\">        scene.background = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Color( <span class=\"number\">0x72645b</span> );</span><br><span class=\"line\">        scene.fog = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Fog( <span class=\"number\">0x72645b</span>, <span class=\"number\">2</span>, <span class=\"number\">15</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Ground</span></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">plane</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Mesh(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.PlaneGeometry( <span class=\"number\">40</span>, <span class=\"number\">40</span> ),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.MeshPhongMaterial( &#123; color: <span class=\"number\">0x999999</span>, specular: <span class=\"number\">0x101010</span> &#125; )</span><br><span class=\"line\">        );</span><br><span class=\"line\">        plane.rotation.x = - Math.PI / <span class=\"number\">2</span>;</span><br><span class=\"line\">        plane.position.y = - <span class=\"number\">0.5</span>;</span><br><span class=\"line\">        scene.add( plane );</span><br><span class=\"line\"></span><br><span class=\"line\">        plane.receiveShadow = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">loader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">STLLoader</span>();</span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Binary files。即 二进制 stl 文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">material</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.MeshPhongMaterial( &#123; color: <span class=\"number\">0xAAAAAA</span>, specular: <span class=\"number\">0x111111</span>, shininess: <span class=\"number\">200</span> &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">        loader.load( <span class=\"string\">&#x27;./model/bysj.stl&#x27;</span>, function ( geometry ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">const</span> <span class=\"variable\">mesh</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Mesh( geometry, material );</span><br><span class=\"line\">            <span class=\"comment\">//模型参数</span></span><br><span class=\"line\">            mesh.position.set( <span class=\"number\">0</span>, - <span class=\"number\">0.18</span>, - <span class=\"number\">0.1</span> );</span><br><span class=\"line\">            mesh.rotation.set( - Math.PI / <span class=\"number\">2</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> );</span><br><span class=\"line\">            mesh.scale.set( <span class=\"number\">0.008</span>, <span class=\"number\">0.008</span>, <span class=\"number\">0.008</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">            mesh.castShadow = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            mesh.receiveShadow = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            scene.add( mesh );</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">        scene.add( <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.HemisphereLight( <span class=\"number\">0x443333</span>, <span class=\"number\">0x111122</span> ) );</span><br><span class=\"line\"></span><br><span class=\"line\">        addShadowedLight( <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0xffffff</span>, <span class=\"number\">1.35</span> );</span><br><span class=\"line\">        addShadowedLight( <span class=\"number\">0.5</span>, <span class=\"number\">1</span>, - <span class=\"number\">1</span>, <span class=\"number\">0xffaa00</span>, <span class=\"number\">1</span> );</span><br><span class=\"line\">        <span class=\"comment\">// renderer</span></span><br><span class=\"line\"></span><br><span class=\"line\">        renderer = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.WebGLRenderer( &#123; antialias: <span class=\"literal\">true</span> &#125; );</span><br><span class=\"line\">        renderer.setPixelRatio( window.devicePixelRatio );</span><br><span class=\"line\">        renderer.setSize( window.innerWidth, window.innerHeight );</span><br><span class=\"line\">        renderer.outputEncoding = THREE.sRGBEncoding;</span><br><span class=\"line\"></span><br><span class=\"line\">        renderer.shadowMap.enabled = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        container.appendChild( renderer.domElement );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// stats</span></span><br><span class=\"line\"></span><br><span class=\"line\">        stats = <span class=\"keyword\">new</span> <span class=\"title class_\">Stats</span>();</span><br><span class=\"line\">        container.appendChild( stats.dom );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">        window.addEventListener( <span class=\"string\">&#x27;resize&#x27;</span>, onWindowResize );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">addShadowedLight</span><span class=\"params\">( x, y, z, color, intensity )</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">directionalLight</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.DirectionalLight( color, intensity );</span><br><span class=\"line\">        directionalLight.position.set( x, y, z );</span><br><span class=\"line\">        scene.add( directionalLight );</span><br><span class=\"line\"></span><br><span class=\"line\">        directionalLight.castShadow = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">d</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        directionalLight.shadow.camera.left = - d;</span><br><span class=\"line\">        directionalLight.shadow.camera.right = d;</span><br><span class=\"line\">        directionalLight.shadow.camera.top = d;</span><br><span class=\"line\">        directionalLight.shadow.camera.bottom = - d;</span><br><span class=\"line\"></span><br><span class=\"line\">        directionalLight.shadow.camera.near = <span class=\"number\">1</span>;</span><br><span class=\"line\">        directionalLight.shadow.camera.far = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        directionalLight.shadow.bias = - <span class=\"number\">0.002</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">onWindowResize</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        camera.aspect = window.innerWidth / window.innerHeight;</span><br><span class=\"line\">        camera.updateProjectionMatrix();</span><br><span class=\"line\"></span><br><span class=\"line\">        renderer.setSize( window.innerWidth, window.innerHeight );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">animate</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        requestAnimationFrame( animate );</span><br><span class=\"line\"></span><br><span class=\"line\">        render();</span><br><span class=\"line\">        stats.update();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">render</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">timer</span> <span class=\"operator\">=</span> Date.now() * <span class=\"number\">0.0005</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        camera.position.x = Math.cos( timer ) * <span class=\"number\">3</span>;</span><br><span class=\"line\">        camera.position.z = Math.sin( timer ) * <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        camera.lookAt( cameraTarget );</span><br><span class=\"line\"></span><br><span class=\"line\">        renderer.render( scene, camera );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<link rel=\"stylesheet\" href=\"/css/spoiler.css\" type=\"text/css\"><script src=\"/js/spoiler.js\" type=\"text/javascript\" async></script>","more":"<h2 id=\"效果展示\"><a href=\"#效果展示\" class=\"headerlink\" title=\"效果展示\"></a>效果展示</h2><iframe id=\"modelFrame\" src=\"https://ts.undf.top/3d/bysj.html\" width=\"100%\" height=\"500px\" style = \"border-radius: 10px;\" frameborder=\"0\"></iframe>\n\n<h2 id=\"关于Threejs\"><a href=\"#关于Threejs\" class=\"headerlink\" title=\"关于Threejs\"></a>关于Threejs</h2><p>Three.js是基于原生WebGL封装运行的三维引擎，在所有WebGL引擎中，Three.js是国内文资料最多、使用最广泛的三维引擎。</p>\n<h2 id=\"Iframe\"><a href=\"#Iframe\" class=\"headerlink\" title=\"Iframe\"></a>Iframe</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;modelFrame&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://ts.undf.top/3d/bysj.html&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100%&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;75%&quot;</span> <span class=\"attr\">style</span> = <span class=\"string\">&quot;border-radius: 10px;&quot;</span> <span class=\"attr\">frameborder</span>=<span class=\"string\">&quot;0&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>为了方便引入，采用iframe框架，可以有效减少引入处的代码长度。</p>\n<h2 id=\"源码仓库\"><a href=\"#源码仓库\" class=\"headerlink\" title=\"源码仓库\"></a>源码仓库</h2><p><a href=\"https://github.com/wxydejoy/Test_gitpage\">点我</a></p>\n<p>仓库内3d文件夹下面即是所有源代码。如果不需要自定义修改，建议复制整个文件夹到你的目录内，如果需要自定义模型和样式，请参照下面的关键代码解释</p>\n<h2 id=\"关键代码\"><a href=\"#关键代码\" class=\"headerlink\" title=\"关键代码\"></a>关键代码</h2><p>如果需要更改js文件的位置需要修改 html 文件里面的位置和 stl.js 文件内的位置。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 如果需要修改文件位置，记得修改这里的路径</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * as THREE from <span class=\"string\">&#x27;./build/three.module.js&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> Stats from <span class=\"string\">&#x27;./build/stats.js&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; STLLoader &#125; from <span class=\"string\">&#x27;./build/stl.js&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    let container, stats;</span><br><span class=\"line\"></span><br><span class=\"line\">    let camera, cameraTarget, scene, renderer;</span><br><span class=\"line\"></span><br><span class=\"line\">    init();</span><br><span class=\"line\">    animate();</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">init</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        container = document.createElement( <span class=\"string\">&#x27;div&#x27;</span> );</span><br><span class=\"line\">        document.body.appendChild( container );</span><br><span class=\"line\"></span><br><span class=\"line\">        camera = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.PerspectiveCamera( <span class=\"number\">35</span>, window.innerWidth / window.innerHeight, <span class=\"number\">1</span>, <span class=\"number\">30</span> );</span><br><span class=\"line\">        camera.position.set( <span class=\"number\">0</span>, <span class=\"number\">0.85</span>, <span class=\"number\">0</span> );</span><br><span class=\"line\">        <span class=\"comment\">//相机位置</span></span><br><span class=\"line\">        cameraTarget = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Vector3( <span class=\"number\">0</span>, - <span class=\"number\">0.25</span>, <span class=\"number\">0</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        scene = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Scene();</span><br><span class=\"line\">        scene.background = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Color( <span class=\"number\">0x72645b</span> );</span><br><span class=\"line\">        scene.fog = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Fog( <span class=\"number\">0x72645b</span>, <span class=\"number\">2</span>, <span class=\"number\">15</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Ground</span></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">plane</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Mesh(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.PlaneGeometry( <span class=\"number\">40</span>, <span class=\"number\">40</span> ),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.MeshPhongMaterial( &#123; color: <span class=\"number\">0x999999</span>, specular: <span class=\"number\">0x101010</span> &#125; )</span><br><span class=\"line\">        );</span><br><span class=\"line\">        plane.rotation.x = - Math.PI / <span class=\"number\">2</span>;</span><br><span class=\"line\">        plane.position.y = - <span class=\"number\">0.5</span>;</span><br><span class=\"line\">        scene.add( plane );</span><br><span class=\"line\"></span><br><span class=\"line\">        plane.receiveShadow = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">loader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">STLLoader</span>();</span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Binary files。即 二进制 stl 文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">material</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.MeshPhongMaterial( &#123; color: <span class=\"number\">0xAAAAAA</span>, specular: <span class=\"number\">0x111111</span>, shininess: <span class=\"number\">200</span> &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">        loader.load( <span class=\"string\">&#x27;./model/bysj.stl&#x27;</span>, function ( geometry ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">const</span> <span class=\"variable\">mesh</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.Mesh( geometry, material );</span><br><span class=\"line\">            <span class=\"comment\">//模型参数</span></span><br><span class=\"line\">            mesh.position.set( <span class=\"number\">0</span>, - <span class=\"number\">0.18</span>, - <span class=\"number\">0.1</span> );</span><br><span class=\"line\">            mesh.rotation.set( - Math.PI / <span class=\"number\">2</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> );</span><br><span class=\"line\">            mesh.scale.set( <span class=\"number\">0.008</span>, <span class=\"number\">0.008</span>, <span class=\"number\">0.008</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">            mesh.castShadow = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            mesh.receiveShadow = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            scene.add( mesh );</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">        scene.add( <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.HemisphereLight( <span class=\"number\">0x443333</span>, <span class=\"number\">0x111122</span> ) );</span><br><span class=\"line\"></span><br><span class=\"line\">        addShadowedLight( <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0xffffff</span>, <span class=\"number\">1.35</span> );</span><br><span class=\"line\">        addShadowedLight( <span class=\"number\">0.5</span>, <span class=\"number\">1</span>, - <span class=\"number\">1</span>, <span class=\"number\">0xffaa00</span>, <span class=\"number\">1</span> );</span><br><span class=\"line\">        <span class=\"comment\">// renderer</span></span><br><span class=\"line\"></span><br><span class=\"line\">        renderer = <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.WebGLRenderer( &#123; antialias: <span class=\"literal\">true</span> &#125; );</span><br><span class=\"line\">        renderer.setPixelRatio( window.devicePixelRatio );</span><br><span class=\"line\">        renderer.setSize( window.innerWidth, window.innerHeight );</span><br><span class=\"line\">        renderer.outputEncoding = THREE.sRGBEncoding;</span><br><span class=\"line\"></span><br><span class=\"line\">        renderer.shadowMap.enabled = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        container.appendChild( renderer.domElement );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// stats</span></span><br><span class=\"line\"></span><br><span class=\"line\">        stats = <span class=\"keyword\">new</span> <span class=\"title class_\">Stats</span>();</span><br><span class=\"line\">        container.appendChild( stats.dom );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">        window.addEventListener( <span class=\"string\">&#x27;resize&#x27;</span>, onWindowResize );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">addShadowedLight</span><span class=\"params\">( x, y, z, color, intensity )</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">directionalLight</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">THREE</span>.DirectionalLight( color, intensity );</span><br><span class=\"line\">        directionalLight.position.set( x, y, z );</span><br><span class=\"line\">        scene.add( directionalLight );</span><br><span class=\"line\"></span><br><span class=\"line\">        directionalLight.castShadow = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">d</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        directionalLight.shadow.camera.left = - d;</span><br><span class=\"line\">        directionalLight.shadow.camera.right = d;</span><br><span class=\"line\">        directionalLight.shadow.camera.top = d;</span><br><span class=\"line\">        directionalLight.shadow.camera.bottom = - d;</span><br><span class=\"line\"></span><br><span class=\"line\">        directionalLight.shadow.camera.near = <span class=\"number\">1</span>;</span><br><span class=\"line\">        directionalLight.shadow.camera.far = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        directionalLight.shadow.bias = - <span class=\"number\">0.002</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">onWindowResize</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        camera.aspect = window.innerWidth / window.innerHeight;</span><br><span class=\"line\">        camera.updateProjectionMatrix();</span><br><span class=\"line\"></span><br><span class=\"line\">        renderer.setSize( window.innerWidth, window.innerHeight );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">animate</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        requestAnimationFrame( animate );</span><br><span class=\"line\"></span><br><span class=\"line\">        render();</span><br><span class=\"line\">        stats.update();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    function <span class=\"title function_\">render</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"variable\">timer</span> <span class=\"operator\">=</span> Date.now() * <span class=\"number\">0.0005</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        camera.position.x = Math.cos( timer ) * <span class=\"number\">3</span>;</span><br><span class=\"line\">        camera.position.z = Math.sin( timer ) * <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        camera.lookAt( cameraTarget );</span><br><span class=\"line\"></span><br><span class=\"line\">        renderer.render( scene, camera );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","categories":[{"name":"💻Code","path":"api/categories/💻Code.json"}],"tags":[{"name":"📦Threejs","path":"api/tags/📦Threejs.json"}]}
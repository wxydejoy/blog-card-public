{"title":"invoice_ocr","slug":"code/invoice_ocr","date":"2022-10-01T08:39:46.000Z","updated":"2023-07-05T14:41:48.353Z","comments":true,"path":"api/articles/code/invoice_ocr.json","excerpt":null,"covers":["https://img.undf.top/cundf/others/invoice_ocr.md/2022-10-01-17-16-47.png","https://img.undf.top/cundf/others/invoice_ocr.md/2022-10-01-17-17-30.png"],"content":"<h2 id=\"因\"><a href=\"#因\" class=\"headerlink\" title=\"因\"></a>因</h2><p>最近实验室财务政策(报销的相关事情)有一些改变，需要自己去写入库单，然后去财务处报销，但是我不想手写Word，然后就有了这个工具。</p>\n<p>之前财务也有用过一个OCR的工具，但是我觉得不太好用，所以就干脆自己写了一个。</p>\n<p>在提高效率的同时，也可以学习一下OCR的相关知识。</p>\n<h2 id=\"用到的库\"><a href=\"#用到的库\" class=\"headerlink\" title=\"用到的库\"></a>用到的库</h2><p>语言当然不用说了，Python。</p>\n<ul>\n<li>ocr(文字识别)：百度的OCR api <a href=\"https://ai.baidu.com/tech/ocr_receipts/vat_invoice\">增值税发票识别</a>（封面也是这里找的）</li>\n<li>json：用来解析百度OCR的返回值</li>\n<li>python-docx：用来生成Word文档</li>\n<li>pypdf2：用来生成PDF文档</li>\n<li>datetime：用来生成时间戳</li>\n</ul>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><ol>\n<li>从淘宝等网站获取订单发票</li>\n<li>用百度OCR识别发票信息</li>\n<li>生成Word文档</li>\n<li>将发票pdf重命名并归档</li>\n</ol>\n<h2 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h2><p>部分效果图如下：</p>\n<p><img src=\"https://img.undf.top/cundf/others/invoice_ocr.md/2022-10-01-17-16-47.png\"></p>\n<p><img src=\"https://img.undf.top/cundf/others/invoice_ocr.md/2022-10-01-17-17-30.png\"></p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><p>很长且没有注释，但是我觉得很好理解，就不贴了。</p>\n<p>其实自己也快忘了hhhh</p>\n<details ><summary>代码很长</summary><div class=\"fold-content\"><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"><span class=\"keyword\">import</span> shutil</span><br><span class=\"line\"><span class=\"keyword\">from</span> time <span class=\"keyword\">import</span> sleep</span><br><span class=\"line\"><span class=\"keyword\">from</span> aip <span class=\"keyword\">import</span> AipOcr</span><br><span class=\"line\"><span class=\"keyword\">import</span> PyPDF2 <span class=\"keyword\">as</span> pdf</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> docx</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot; 你的 APPID AK SK &quot;&quot;&quot;</span></span><br><span class=\"line\">APP_ID = <span class=\"string\">&#x27;xxxx&#x27;</span></span><br><span class=\"line\">API_KEY = <span class=\"string\">&#x27;xxx&#x27;</span></span><br><span class=\"line\">SECRET_KEY = <span class=\"string\">&#x27;xxxx&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">client = AipOcr(APP_ID, API_KEY, SECRET_KEY)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot; 读取pdf &quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_file_content</span>(<span class=\"params\">filePath</span>):</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filePath, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fp.read()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 遍历文件夹下所有pdf文件</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_pdffiles</span>(<span class=\"params\">dir_path</span>):</span><br><span class=\"line\">    <span class=\"keyword\">import</span> os</span><br><span class=\"line\">    files = os.listdir(dir_path)</span><br><span class=\"line\">    pdf_files = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> files:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> file.endswith(<span class=\"string\">&#x27;.pdf&#x27;</span>):</span><br><span class=\"line\">            pdf_files.append(dir_path+<span class=\"string\">&#x27;/&#x27;</span>+file)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pdf_files</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 商品类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Commodity</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        self.name = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.<span class=\"built_in\">type</span> = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.unit = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.price = <span class=\"number\">0</span></span><br><span class=\"line\">        self.tax_rate = <span class=\"number\">0</span></span><br><span class=\"line\">        self.tax = <span class=\"number\">0</span></span><br><span class=\"line\">        self.total_price = <span class=\"number\">0</span></span><br><span class=\"line\">        self.num = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 入库单类</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 入库单</span></span><br><span class=\"line\"><span class=\"comment\"># Warehouse receipt</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">WarehouseReceipt</span>():</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, pdf_file_path=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">        self.order_num = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.order_date = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.supplier = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.commodity_list = []</span><br><span class=\"line\">        self.total_price = <span class=\"number\">0</span></span><br><span class=\"line\">        self.json = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.pdf_file_path = pdf_file_path</span><br><span class=\"line\">        self.company = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.c_price = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__str__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;订单号：&#x27;</span>+self.order_num+<span class=\"string\">&#x27;，订单日期：&#x27;</span>+self.order_date+<span class=\"string\">&#x27;，供应商：&#x27;</span>+self.supplier+<span class=\"string\">&#x27;，总价：&#x27;</span>+self.total_price</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">ocr</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"comment\"># pdf_file_path = &#x27;invoice/1.pdf&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.get_pdf_num() &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;pdf文件页数大于1,暂不支持&#x27;)</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;pdf文件页数为1&#x27;)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;开始识别&#x27;)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(self.pdf_file_path)</span></span><br><span class=\"line\">            pdf_file = self.get_file_content()</span><br><span class=\"line\">            self.json = client.vatInvoicePdf(pdf_file)</span><br><span class=\"line\">            <span class=\"comment\"># with open(&#x27;&#123;&#125;.json&#x27;.format(self.pdf_file_path), &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">            <span class=\"comment\">#     json.dump(self.json, f, ensure_ascii=False, indent=4)</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">#print(self.json)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">ocr_pic</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"comment\"># pdf 转图片</span></span><br><span class=\"line\">        <span class=\"keyword\">def</span> <span class=\"title function_\">pdf_to_pic</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">            <span class=\"keyword\">from</span> pdf2image <span class=\"keyword\">import</span> convert_from_path</span><br><span class=\"line\">            pages = convert_from_path(self.pdf_file_path, <span class=\"number\">200</span>)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> pages:</span><br><span class=\"line\">                page.save(self.pdf_file_path.replace(<span class=\"string\">&#x27;.pdf&#x27;</span>,<span class=\"string\">&#x27;.jpg&#x27;</span>), <span class=\"string\">&#x27;JPEG&#x27;</span>)</span><br><span class=\"line\">        pdf_to_pic(self)</span><br><span class=\"line\">        <span class=\"comment\"># 识别图片</span></span><br><span class=\"line\">        image = self.get_pic_content()</span><br><span class=\"line\">        </span><br><span class=\"line\">        self.json = client.receipt(image)</span><br><span class=\"line\">        <span class=\"comment\"># 保存json数据</span></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;invoice/&#123;&#125;.json&#x27;</span>.<span class=\"built_in\">format</span>(self.pdf_file_path), <span class=\"string\">&#x27;w&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            json.dump(self.json, f, ensure_ascii=<span class=\"literal\">False</span>, indent=<span class=\"number\">4</span>)</span><br><span class=\"line\">        <span class=\"comment\">#print(self.json)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">handle_json</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\"></span><br><span class=\"line\">        json_data = self.json</span><br><span class=\"line\">        <span class=\"comment\"># 商品对象列表</span></span><br><span class=\"line\">        self.commodity_list = []</span><br><span class=\"line\"></span><br><span class=\"line\">        words_result = json_data[<span class=\"string\">&#x27;words_result&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>])):</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品名称</span></span><br><span class=\"line\">            self.commodity_list.append(Commodity())</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i == <span class=\"built_in\">len</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>])-<span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>][i][<span class=\"string\">&#x27;row&#x27;</span>])-<span class=\"number\">1</span>, <span class=\"built_in\">len</span>(words_result[<span class=\"string\">&#x27;CommodityName&#x27;</span>])):</span><br><span class=\"line\">                    <span class=\"comment\">#print(i, j)</span></span><br><span class=\"line\">                    self.commodity_list[i].name += words_result[<span class=\"string\">&#x27;CommodityName&#x27;</span>][j][<span class=\"string\">&#x27;word&#x27;</span>]</span><br><span class=\"line\">                    <span class=\"comment\"># self.commodity_list[i]+=(words_result[&#x27;CommodityName&#x27;][j][&#x27;word&#x27;])</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>][i][<span class=\"string\">&#x27;row&#x27;</span>])-<span class=\"number\">1</span>, <span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>][i+<span class=\"number\">1</span>][<span class=\"string\">&#x27;row&#x27;</span>])-<span class=\"number\">1</span>):</span><br><span class=\"line\">                    <span class=\"comment\">#print(i, j)</span></span><br><span class=\"line\">                    self.commodity_list[i].name += words_result[<span class=\"string\">&#x27;CommodityName&#x27;</span>][j][<span class=\"string\">&#x27;word&#x27;</span>]</span><br><span class=\"line\">                    <span class=\"comment\"># self.commodity_list[i]+=(words_result[&#x27;CommodityName&#x27;][j][&#x27;word&#x27;])</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品单价(含税)</span></span><br><span class=\"line\">            <span class=\"comment\"># 判断是否含税</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;%&#x27;</span> <span class=\"keyword\">in</span> words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]:</span><br><span class=\"line\">                <span class=\"comment\">#print(&#x27;含税&#x27;,i)</span></span><br><span class=\"line\">                <span class=\"comment\">#print(&#x27;ll&#x27;,self.commodity_list)</span></span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">#print(&#x27;ll&#x27;,self.commodity_list[i])</span></span><br><span class=\"line\"></span><br><span class=\"line\">                self.commodity_list[i].price = <span class=\"built_in\">float</span>(</span><br><span class=\"line\">                    words_result[<span class=\"string\">&#x27;CommodityPrice&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]) + <span class=\"built_in\">float</span>(words_result[<span class=\"string\">&#x27;CommodityTax&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]) / <span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityNum&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>])</span><br><span class=\"line\">                <span class=\"comment\">#print(&#x27;%&#x27;)</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                self.commodity_list[i].price = <span class=\"built_in\">float</span>(</span><br><span class=\"line\">                    words_result[<span class=\"string\">&#x27;CommodityPrice&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品类型(只能单页)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> words_result[<span class=\"string\">&#x27;CommodityType&#x27;</span>]:</span><br><span class=\"line\">                self.commodity_list[i].<span class=\"built_in\">type</span> = words_result[<span class=\"string\">&#x27;CommodityType&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">#self.commodity_list[i].price = words_result[&#x27;CommodityPrice&#x27;][i][&#x27;word&#x27;]</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 单个商品总价</span></span><br><span class=\"line\">            self.commodity_list[i].total_price = self.commodity_list[i].price * \\</span><br><span class=\"line\">                <span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityNum&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 处理单价和总价的小数点</span></span><br><span class=\"line\">            self.commodity_list[i].price = <span class=\"built_in\">round</span>(</span><br><span class=\"line\">                self.commodity_list[i].price, <span class=\"number\">2</span>)</span><br><span class=\"line\">            self.commodity_list[i].total_price = <span class=\"built_in\">round</span>(</span><br><span class=\"line\">                self.commodity_list[i].total_price, <span class=\"number\">2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            self.commodity_list[i].num = <span class=\"built_in\">int</span>(</span><br><span class=\"line\">                words_result[<span class=\"string\">&#x27;CommodityNum&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品单位</span></span><br><span class=\"line\">            self.commodity_list[i].unit = words_result[<span class=\"string\">&#x27;CommodityUnit&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            </span><br><span class=\"line\">        self.total_price = <span class=\"built_in\">float</span>(words_result[<span class=\"string\">&#x27;AmountInFiguers&#x27;</span>])</span><br><span class=\"line\">        self.order_date = words_result[<span class=\"string\">&#x27;InvoiceDate&#x27;</span>]</span><br><span class=\"line\">        self.company = words_result[<span class=\"string\">&#x27;SellerName&#x27;</span>]</span><br><span class=\"line\">        self.c_price = words_result[<span class=\"string\">&#x27;AmountInWords&#x27;</span>]</span><br><span class=\"line\">            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品名称</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">#print(self.commodity_list)</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> self.commodity_list:</span><br><span class=\"line\">            <span class=\"comment\">#print(i.name)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.price)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.total_price)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.num)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.type)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.unit)</span></span><br><span class=\"line\">            <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 生成入库单word文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">generate_word</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.shared <span class=\"keyword\">import</span> Pt</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.oxml.ns <span class=\"keyword\">import</span> qn</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.shared <span class=\"keyword\">import</span> Inches</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.enum.text <span class=\"keyword\">import</span> WD_ALIGN_PARAGRAPH</span><br><span class=\"line\">        <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.enum.table <span class=\"keyword\">import</span> WD_TABLE_ALIGNMENT</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.enum.table <span class=\"keyword\">import</span> WD_ALIGN_VERTICAL</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.enum.text <span class=\"keyword\">import</span> WD_PARAGRAPH_ALIGNMENT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 生成word文件</span></span><br><span class=\"line\">        doc = docx.Document()</span><br><span class=\"line\">        <span class=\"comment\"># 设置所有字体为宋体</span></span><br><span class=\"line\">        doc.styles[<span class=\"string\">&#x27;Normal&#x27;</span>].font.name = <span class=\"string\">u&#x27;宋体&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        doc.styles[<span class=\"string\">&#x27;Normal&#x27;</span>]._element.rPr.rFonts.<span class=\"built_in\">set</span>(qn(<span class=\"string\">&#x27;w:eastAsia&#x27;</span>), <span class=\"string\">u&#x27;宋体&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 设置所有段落的行距为1.5倍</span></span><br><span class=\"line\">        doc.styles[<span class=\"string\">&#x27;Normal&#x27;</span>].paragraph_format.line_spacing = <span class=\"number\">1.5</span></span><br><span class=\"line\">        <span class=\"comment\"># 设置</span></span><br><span class=\"line\">        title = doc.add_paragraph(<span class=\"string\">&quot;浙江工业大学耗材入库单&quot;</span>, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 设置标题字体大小</span></span><br><span class=\"line\">        title.runs[<span class=\"number\">0</span>].font.size = Pt(<span class=\"number\">18</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 加粗</span></span><br><span class=\"line\">        title.runs[<span class=\"number\">0</span>].font.bold = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"comment\"># 设置标题居中</span></span><br><span class=\"line\">        title.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 添加当天时间</span></span><br><span class=\"line\">        today = datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y年%m月%d日&#x27;</span>)</span><br><span class=\"line\">        today = doc.add_paragraph(today, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\">        today.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 添加部门公章</span></span><br><span class=\"line\">        doc.add_paragraph(<span class=\"string\">&quot;部门（公章）：\t\t\t\t\t\t\t单位：\t元&quot;</span>, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 设置表格</span></span><br><span class=\"line\">        table = doc.add_table(rows=<span class=\"number\">1</span>, cols=<span class=\"number\">7</span>, style=<span class=\"string\">&#x27;Table Grid&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 左下</span></span><br><span class=\"line\">        table.alignment = WD_ALIGN_VERTICAL.CENTER</span><br><span class=\"line\">        <span class=\"comment\"># table.alignment = </span></span><br><span class=\"line\">        <span class=\"comment\"># table.alignment = WD_TABLE_ALIGNMENT.LEFT</span></span><br><span class=\"line\">        <span class=\"comment\"># table.alignment = WD_TABLE_ALIGNMENT.BOTTOM</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 根据内容自动调整列宽</span></span><br><span class=\"line\">        <span class=\"comment\"># table.autofit = True</span></span><br><span class=\"line\">        <span class=\"comment\"># table.autofitcontent = True</span></span><br><span class=\"line\">        <span class=\"comment\"># 设置每一列的宽度</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">1</span>).width = Inches(<span class=\"number\">4</span>)</span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">2</span>).width = Inches(<span class=\"number\">3</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 设置 首行</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">0</span>).text = <span class=\"string\">&#x27;供货单位&#x27;</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">1</span>).text = self.company</span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">2</span>).text = <span class=\"string\">&#x27;入库日期&#x27;</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">3</span>).text = self.order_date</span><br><span class=\"line\">        <span class=\"comment\"># 合并单元格</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">3</span>).merge(table.cell(<span class=\"number\">0</span>, <span class=\"number\">4</span>))</span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">5</span>).text = <span class=\"string\">&#x27;入库单号&#x27;</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">6</span>).text = self.order_num</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 表格 根据内容自动调整</span></span><br><span class=\"line\">        table.allow_autofit = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        hdr_cells = table.add_row().cells</span><br><span class=\"line\">        hdr_cells[<span class=\"number\">0</span>].text = <span class=\"string\">&#x27;序号&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">1</span>].text = <span class=\"string\">&#x27;耗材名称&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">2</span>].text = <span class=\"string\">&#x27;规格型号&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">3</span>].text = <span class=\"string\">&#x27;单位&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">4</span>].text = <span class=\"string\">&#x27;数量&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">5</span>].text = <span class=\"string\">&#x27;单价&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">6</span>].text = <span class=\"string\">&#x27;金额&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> index,i <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(self.commodity_list):</span><br><span class=\"line\">            row_cells = table.add_row().cells</span><br><span class=\"line\">            row_cells[<span class=\"number\">0</span>].text = <span class=\"built_in\">str</span>(index+<span class=\"number\">1</span>)</span><br><span class=\"line\">            row_cells[<span class=\"number\">1</span>].text = i.name</span><br><span class=\"line\">            row_cells[<span class=\"number\">2</span>].text = i.<span class=\"built_in\">type</span></span><br><span class=\"line\">            row_cells[<span class=\"number\">3</span>].text = i.unit</span><br><span class=\"line\">            row_cells[<span class=\"number\">4</span>].text = <span class=\"built_in\">str</span>(i.num)</span><br><span class=\"line\">            row_cells[<span class=\"number\">5</span>].text = <span class=\"built_in\">str</span>(i.price)</span><br><span class=\"line\">            row_cells[<span class=\"number\">6</span>].text = <span class=\"built_in\">str</span>(i.total_price)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 合计行</span></span><br><span class=\"line\">        row_cells = table.add_row().cells</span><br><span class=\"line\">        row_cells[<span class=\"number\">0</span>].text = <span class=\"string\">&#x27;合计&#x27;</span></span><br><span class=\"line\">        <span class=\"comment\"># 合并单元格</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        row_cells[<span class=\"number\">1</span>].text = <span class=\"string\">&#x27;(大写)&#x27;</span></span><br><span class=\"line\">        row_cells[<span class=\"number\">2</span>].merge(row_cells[<span class=\"number\">3</span>]).merge(row_cells[<span class=\"number\">4</span>]).text = self.c_price</span><br><span class=\"line\">        row_cells[<span class=\"number\">5</span>].text = <span class=\"string\">&#x27;(小写)&#x27;</span></span><br><span class=\"line\">        row_cells[<span class=\"number\">6</span>].text = <span class=\"built_in\">str</span>(self.total_price)</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 添加制表等</span></span><br><span class=\"line\">        doc.add_paragraph(<span class=\"string\">&quot;制表（保管）：\t\t\t采购：\t\t\t入库验收：&quot;</span>, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        last = doc.add_paragraph(</span><br><span class=\"line\">            <span class=\"string\">&quot;第一联：存根联\t第二联：财务\t第三联：供货单位（采购）\t第四联：验收人&quot;</span>, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\">        last.runs[<span class=\"number\">0</span>].font.size = Pt(<span class=\"number\">10</span>)</span><br><span class=\"line\">        last.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER</span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 保存文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">        doc.save(<span class=\"string\">&#x27;invoice/word/&#x27;</span>+<span class=\"built_in\">str</span>(self.total_price)+self.company+self.order_date+<span class=\"string\">&#x27;.docx&#x27;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">get_file_content</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(self.pdf_file_path, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fp.read()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">get_pic_content</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(self.pdf_file_path.replace(<span class=\"string\">&#x27;.pdf&#x27;</span>,<span class=\"string\">&#x27;.jpg&#x27;</span>), <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fp.read()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 获取pdf页码</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">get_pdf_num</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        pdfFileObj = <span class=\"built_in\">open</span>(self.pdf_file_path, <span class=\"string\">&#x27;rb&#x27;</span>)</span><br><span class=\"line\">        pdfReader = pdf.PdfFileReader(pdfFileObj)</span><br><span class=\"line\">        num = pdfReader.numPages</span><br><span class=\"line\">        <span class=\"keyword\">return</span> num</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">cp</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"comment\"># 复制并重命名pdf文件</span></span><br><span class=\"line\">        shutil.copy(self.pdf_file_path, <span class=\"string\">&#x27;invoice/pdf/&#x27;</span>+<span class=\"built_in\">str</span>(self.total_price)+self.company+self.order_date+<span class=\"string\">&#x27;.pdf&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 删除原pdf文件</span></span><br><span class=\"line\">        os.remove(self.pdf_file_path)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">deal</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        self.ocr()</span><br><span class=\"line\">        <span class=\"comment\"># 捕捉异常</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            self.handle_json()</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(e, <span class=\"string\">&#x27;json文件处理失败&#x27;</span>)</span><br><span class=\"line\">            <span class=\"comment\"># 创建错误日志</span></span><br><span class=\"line\">            <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;invoice/log/error-&#123;&#125;.log&#x27;</span>.<span class=\"built_in\">format</span>(datetime.now().strftime(<span class=\"string\">&#x27;%Y年%m月%d日%H-%M&#x27;</span>)), <span class=\"string\">&#x27;a&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                f.write(self.pdf_file_path+<span class=\"string\">&#x27;  &#x27;</span>+<span class=\"built_in\">str</span>(e) +</span><br><span class=\"line\">                        <span class=\"string\">&#x27;\\r\\n&#x27;</span>+<span class=\"built_in\">str</span>(self.json)+<span class=\"string\">&#x27;\\r\\n&#x27;</span>)</span><br><span class=\"line\">            <span class=\"comment\">#print(e)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;处理json文件出错&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\"># 抛出异常</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;处理json文件成功&#x27;)</span></span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;处理json文件成功&#x27;</span>,self.pdf_file_path)</span><br><span class=\"line\">            <span class=\"comment\"># 创建成功日志</span></span><br><span class=\"line\">            <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;invoice/log/success-&#123;&#125;.log&#x27;</span>.<span class=\"built_in\">format</span>(datetime.now().strftime(<span class=\"string\">&#x27;%Y年%m月%d日%H-%M&#x27;</span>)), <span class=\"string\">&#x27;a&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                f.write(self.pdf_file_path+<span class=\"string\">&#x27;\\r\\n&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        self.generate_word()</span><br><span class=\"line\">        self.cp()</span><br><span class=\"line\">        <span class=\"comment\"># options = &#123;&#125;</span></span><br><span class=\"line\">        <span class=\"comment\"># options[&#x27;pdf_file_num&#x27;] = get_pdf_num(pdf_file_path)</span></span><br><span class=\"line\">        <span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file, options)</span></span><br><span class=\"line\">        <span class=\"comment\"># # 保存json数据</span></span><br><span class=\"line\">        <span class=\"comment\"># with open(&#x27;invoice/1.json&#x27;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">        <span class=\"comment\">#     json.dump(res_pdf, f, ensure_ascii=False, indent=4)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">dealdebug</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        self.ocr()</span><br><span class=\"line\">        <span class=\"comment\"># 捕捉异常</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        self.handle_json()</span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        self.generate_word()</span><br><span class=\"line\">        <span class=\"comment\"># options = &#123;&#125;</span></span><br><span class=\"line\">        <span class=\"comment\"># options[&#x27;pdf_file_num&#x27;] = get_pdf_num(pdf_file_path)</span></span><br><span class=\"line\">        <span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file, options)</span></span><br><span class=\"line\">        <span class=\"comment\"># # 保存json数据</span></span><br><span class=\"line\">        <span class=\"comment\"># with open(&#x27;invoice/1.json&#x27;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">        <span class=\"comment\">#     json.dump(res_pdf, f, ensure_ascii=False, indent=4)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># read json</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># def read_json(file_path):</span></span><br><span class=\"line\"><span class=\"comment\">#     with open(file_path, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\"><span class=\"comment\">#         json_data = json.load(f)</span></span><br><span class=\"line\"><span class=\"comment\">#         handle_json(json_data)</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> get_pdffiles(<span class=\"string\">&#x27;invoice/new&#x27;</span>):</span><br><span class=\"line\">        WarehouseReceipt(i).deal()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">#WarehouseReceipt(&#x27;invoice/new/202205171971483062.pdf&#x27;).dealdebug()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># WarehouseReceipt(&#x27;invoice\\new\\202209102153729425.pdf&#x27;).deal()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># wh1 = WarehouseReceipt(&#x27;invoice/invoice.pdf&#x27;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># with open(&#x27;invoice/invoice.json&#x27;, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">    <span class=\"comment\">#     wh1.json = json.load(f)</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.ocr()</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.handle_json()</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.deal()</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.handle_json()</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># wh1 = WarehouseReceipt()</span></span><br><span class=\"line\">    <span class=\"comment\"># with open(&#x27;invoice/invoice.json&#x27;, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">    <span class=\"comment\">#     wh1.json = json.load(f)</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.handle_json()</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.generate_word()</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># read_json(&#x27;invoice/invoice.json&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\"># read_json(&#x27;invoice/1.json&#x27;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># pdf_file_path = &#x27;invoice/1.pdf&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\"># pdf_file = get_file_content(pdf_file_path)</span></span><br><span class=\"line\">    <span class=\"comment\"># options = &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># options[&#x27;pdf_file_num&#x27;] = get_pdf_num(pdf_file_path)</span></span><br><span class=\"line\">    <span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file, options)</span></span><br><span class=\"line\">    <span class=\"comment\"># # 保存json数据</span></span><br><span class=\"line\">    <span class=\"comment\"># with open(&#x27;invoice/1.json&#x27;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">    <span class=\"comment\">#     json.dump(res_pdf, f, ensure_ascii=False, indent=4)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取json数据(测试用)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 调用增值税发票识别</span></span><br><span class=\"line\"><span class=\"comment\"># res_image = client.vatInvoice(image)</span></span><br><span class=\"line\"><span class=\"comment\"># res_url = client.vatInvoiceUrl(url)</span></span><br><span class=\"line\"><span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_image)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_url)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_pdf)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果有可选参数</span></span><br><span class=\"line\"><span class=\"comment\"># options = &#123;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># options[&#x27;pdf_file_num&#x27;] = get_invoice_num(file_path)</span></span><br><span class=\"line\"><span class=\"comment\"># res_image = client.vatInvoice(image, options)</span></span><br><span class=\"line\"><span class=\"comment\"># res_url = client.vatInvoiceUrl(url, options)</span></span><br><span class=\"line\"><span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file, options)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_image)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_url)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_pdf)</span></span><br></pre></td></tr></table></figure>\n</div></details>","more":"<h2 id=\"因\"><a href=\"#因\" class=\"headerlink\" title=\"因\"></a>因</h2><p>最近实验室财务政策(报销的相关事情)有一些改变，需要自己去写入库单，然后去财务处报销，但是我不想手写Word，然后就有了这个工具。</p>\n<p>之前财务也有用过一个OCR的工具，但是我觉得不太好用，所以就干脆自己写了一个。</p>\n<p>在提高效率的同时，也可以学习一下OCR的相关知识。</p>\n<h2 id=\"用到的库\"><a href=\"#用到的库\" class=\"headerlink\" title=\"用到的库\"></a>用到的库</h2><p>语言当然不用说了，Python。</p>\n<ul>\n<li>ocr(文字识别)：百度的OCR api <a href=\"https://ai.baidu.com/tech/ocr_receipts/vat_invoice\">增值税发票识别</a>（封面也是这里找的）</li>\n<li>json：用来解析百度OCR的返回值</li>\n<li>python-docx：用来生成Word文档</li>\n<li>pypdf2：用来生成PDF文档</li>\n<li>datetime：用来生成时间戳</li>\n</ul>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><ol>\n<li>从淘宝等网站获取订单发票</li>\n<li>用百度OCR识别发票信息</li>\n<li>生成Word文档</li>\n<li>将发票pdf重命名并归档</li>\n</ol>\n<h2 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h2><p>部分效果图如下：</p>\n<p><img src=\"https://img.undf.top/cundf/others/invoice_ocr.md/2022-10-01-17-16-47.png\"></p>\n<p><img src=\"https://img.undf.top/cundf/others/invoice_ocr.md/2022-10-01-17-17-30.png\"></p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><p>很长且没有注释，但是我觉得很好理解，就不贴了。</p>\n<p>其实自己也快忘了hhhh</p>\n<details ><summary>代码很长</summary><div class=\"fold-content\"><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"><span class=\"keyword\">import</span> shutil</span><br><span class=\"line\"><span class=\"keyword\">from</span> time <span class=\"keyword\">import</span> sleep</span><br><span class=\"line\"><span class=\"keyword\">from</span> aip <span class=\"keyword\">import</span> AipOcr</span><br><span class=\"line\"><span class=\"keyword\">import</span> PyPDF2 <span class=\"keyword\">as</span> pdf</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> docx</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot; 你的 APPID AK SK &quot;&quot;&quot;</span></span><br><span class=\"line\">APP_ID = <span class=\"string\">&#x27;xxxx&#x27;</span></span><br><span class=\"line\">API_KEY = <span class=\"string\">&#x27;xxx&#x27;</span></span><br><span class=\"line\">SECRET_KEY = <span class=\"string\">&#x27;xxxx&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">client = AipOcr(APP_ID, API_KEY, SECRET_KEY)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot; 读取pdf &quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_file_content</span>(<span class=\"params\">filePath</span>):</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filePath, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fp.read()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 遍历文件夹下所有pdf文件</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_pdffiles</span>(<span class=\"params\">dir_path</span>):</span><br><span class=\"line\">    <span class=\"keyword\">import</span> os</span><br><span class=\"line\">    files = os.listdir(dir_path)</span><br><span class=\"line\">    pdf_files = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> files:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> file.endswith(<span class=\"string\">&#x27;.pdf&#x27;</span>):</span><br><span class=\"line\">            pdf_files.append(dir_path+<span class=\"string\">&#x27;/&#x27;</span>+file)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pdf_files</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 商品类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Commodity</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        self.name = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.<span class=\"built_in\">type</span> = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.unit = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.price = <span class=\"number\">0</span></span><br><span class=\"line\">        self.tax_rate = <span class=\"number\">0</span></span><br><span class=\"line\">        self.tax = <span class=\"number\">0</span></span><br><span class=\"line\">        self.total_price = <span class=\"number\">0</span></span><br><span class=\"line\">        self.num = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 入库单类</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 入库单</span></span><br><span class=\"line\"><span class=\"comment\"># Warehouse receipt</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">WarehouseReceipt</span>():</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, pdf_file_path=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">        self.order_num = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.order_date = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.supplier = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.commodity_list = []</span><br><span class=\"line\">        self.total_price = <span class=\"number\">0</span></span><br><span class=\"line\">        self.json = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.pdf_file_path = pdf_file_path</span><br><span class=\"line\">        self.company = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        self.c_price = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__str__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;订单号：&#x27;</span>+self.order_num+<span class=\"string\">&#x27;，订单日期：&#x27;</span>+self.order_date+<span class=\"string\">&#x27;，供应商：&#x27;</span>+self.supplier+<span class=\"string\">&#x27;，总价：&#x27;</span>+self.total_price</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">ocr</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"comment\"># pdf_file_path = &#x27;invoice/1.pdf&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.get_pdf_num() &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;pdf文件页数大于1,暂不支持&#x27;)</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;pdf文件页数为1&#x27;)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;开始识别&#x27;)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(self.pdf_file_path)</span></span><br><span class=\"line\">            pdf_file = self.get_file_content()</span><br><span class=\"line\">            self.json = client.vatInvoicePdf(pdf_file)</span><br><span class=\"line\">            <span class=\"comment\"># with open(&#x27;&#123;&#125;.json&#x27;.format(self.pdf_file_path), &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">            <span class=\"comment\">#     json.dump(self.json, f, ensure_ascii=False, indent=4)</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">#print(self.json)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">ocr_pic</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"comment\"># pdf 转图片</span></span><br><span class=\"line\">        <span class=\"keyword\">def</span> <span class=\"title function_\">pdf_to_pic</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">            <span class=\"keyword\">from</span> pdf2image <span class=\"keyword\">import</span> convert_from_path</span><br><span class=\"line\">            pages = convert_from_path(self.pdf_file_path, <span class=\"number\">200</span>)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> pages:</span><br><span class=\"line\">                page.save(self.pdf_file_path.replace(<span class=\"string\">&#x27;.pdf&#x27;</span>,<span class=\"string\">&#x27;.jpg&#x27;</span>), <span class=\"string\">&#x27;JPEG&#x27;</span>)</span><br><span class=\"line\">        pdf_to_pic(self)</span><br><span class=\"line\">        <span class=\"comment\"># 识别图片</span></span><br><span class=\"line\">        image = self.get_pic_content()</span><br><span class=\"line\">        </span><br><span class=\"line\">        self.json = client.receipt(image)</span><br><span class=\"line\">        <span class=\"comment\"># 保存json数据</span></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;invoice/&#123;&#125;.json&#x27;</span>.<span class=\"built_in\">format</span>(self.pdf_file_path), <span class=\"string\">&#x27;w&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            json.dump(self.json, f, ensure_ascii=<span class=\"literal\">False</span>, indent=<span class=\"number\">4</span>)</span><br><span class=\"line\">        <span class=\"comment\">#print(self.json)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">handle_json</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\"></span><br><span class=\"line\">        json_data = self.json</span><br><span class=\"line\">        <span class=\"comment\"># 商品对象列表</span></span><br><span class=\"line\">        self.commodity_list = []</span><br><span class=\"line\"></span><br><span class=\"line\">        words_result = json_data[<span class=\"string\">&#x27;words_result&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>])):</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品名称</span></span><br><span class=\"line\">            self.commodity_list.append(Commodity())</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i == <span class=\"built_in\">len</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>])-<span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>][i][<span class=\"string\">&#x27;row&#x27;</span>])-<span class=\"number\">1</span>, <span class=\"built_in\">len</span>(words_result[<span class=\"string\">&#x27;CommodityName&#x27;</span>])):</span><br><span class=\"line\">                    <span class=\"comment\">#print(i, j)</span></span><br><span class=\"line\">                    self.commodity_list[i].name += words_result[<span class=\"string\">&#x27;CommodityName&#x27;</span>][j][<span class=\"string\">&#x27;word&#x27;</span>]</span><br><span class=\"line\">                    <span class=\"comment\"># self.commodity_list[i]+=(words_result[&#x27;CommodityName&#x27;][j][&#x27;word&#x27;])</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>][i][<span class=\"string\">&#x27;row&#x27;</span>])-<span class=\"number\">1</span>, <span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>][i+<span class=\"number\">1</span>][<span class=\"string\">&#x27;row&#x27;</span>])-<span class=\"number\">1</span>):</span><br><span class=\"line\">                    <span class=\"comment\">#print(i, j)</span></span><br><span class=\"line\">                    self.commodity_list[i].name += words_result[<span class=\"string\">&#x27;CommodityName&#x27;</span>][j][<span class=\"string\">&#x27;word&#x27;</span>]</span><br><span class=\"line\">                    <span class=\"comment\"># self.commodity_list[i]+=(words_result[&#x27;CommodityName&#x27;][j][&#x27;word&#x27;])</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品单价(含税)</span></span><br><span class=\"line\">            <span class=\"comment\"># 判断是否含税</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;%&#x27;</span> <span class=\"keyword\">in</span> words_result[<span class=\"string\">&#x27;CommodityTaxRate&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]:</span><br><span class=\"line\">                <span class=\"comment\">#print(&#x27;含税&#x27;,i)</span></span><br><span class=\"line\">                <span class=\"comment\">#print(&#x27;ll&#x27;,self.commodity_list)</span></span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">#print(&#x27;ll&#x27;,self.commodity_list[i])</span></span><br><span class=\"line\"></span><br><span class=\"line\">                self.commodity_list[i].price = <span class=\"built_in\">float</span>(</span><br><span class=\"line\">                    words_result[<span class=\"string\">&#x27;CommodityPrice&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]) + <span class=\"built_in\">float</span>(words_result[<span class=\"string\">&#x27;CommodityTax&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]) / <span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityNum&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>])</span><br><span class=\"line\">                <span class=\"comment\">#print(&#x27;%&#x27;)</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                self.commodity_list[i].price = <span class=\"built_in\">float</span>(</span><br><span class=\"line\">                    words_result[<span class=\"string\">&#x27;CommodityPrice&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品类型(只能单页)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> words_result[<span class=\"string\">&#x27;CommodityType&#x27;</span>]:</span><br><span class=\"line\">                self.commodity_list[i].<span class=\"built_in\">type</span> = words_result[<span class=\"string\">&#x27;CommodityType&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">#self.commodity_list[i].price = words_result[&#x27;CommodityPrice&#x27;][i][&#x27;word&#x27;]</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 单个商品总价</span></span><br><span class=\"line\">            self.commodity_list[i].total_price = self.commodity_list[i].price * \\</span><br><span class=\"line\">                <span class=\"built_in\">int</span>(words_result[<span class=\"string\">&#x27;CommodityNum&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 处理单价和总价的小数点</span></span><br><span class=\"line\">            self.commodity_list[i].price = <span class=\"built_in\">round</span>(</span><br><span class=\"line\">                self.commodity_list[i].price, <span class=\"number\">2</span>)</span><br><span class=\"line\">            self.commodity_list[i].total_price = <span class=\"built_in\">round</span>(</span><br><span class=\"line\">                self.commodity_list[i].total_price, <span class=\"number\">2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            self.commodity_list[i].num = <span class=\"built_in\">int</span>(</span><br><span class=\"line\">                words_result[<span class=\"string\">&#x27;CommodityNum&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品单位</span></span><br><span class=\"line\">            self.commodity_list[i].unit = words_result[<span class=\"string\">&#x27;CommodityUnit&#x27;</span>][i][<span class=\"string\">&#x27;word&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            </span><br><span class=\"line\">        self.total_price = <span class=\"built_in\">float</span>(words_result[<span class=\"string\">&#x27;AmountInFiguers&#x27;</span>])</span><br><span class=\"line\">        self.order_date = words_result[<span class=\"string\">&#x27;InvoiceDate&#x27;</span>]</span><br><span class=\"line\">        self.company = words_result[<span class=\"string\">&#x27;SellerName&#x27;</span>]</span><br><span class=\"line\">        self.c_price = words_result[<span class=\"string\">&#x27;AmountInWords&#x27;</span>]</span><br><span class=\"line\">            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 商品名称</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">#print(self.commodity_list)</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> self.commodity_list:</span><br><span class=\"line\">            <span class=\"comment\">#print(i.name)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.price)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.total_price)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.num)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.type)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(i.unit)</span></span><br><span class=\"line\">            <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 生成入库单word文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">generate_word</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.shared <span class=\"keyword\">import</span> Pt</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.oxml.ns <span class=\"keyword\">import</span> qn</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.shared <span class=\"keyword\">import</span> Inches</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.enum.text <span class=\"keyword\">import</span> WD_ALIGN_PARAGRAPH</span><br><span class=\"line\">        <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.enum.table <span class=\"keyword\">import</span> WD_TABLE_ALIGNMENT</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.enum.table <span class=\"keyword\">import</span> WD_ALIGN_VERTICAL</span><br><span class=\"line\">        <span class=\"keyword\">from</span> docx.enum.text <span class=\"keyword\">import</span> WD_PARAGRAPH_ALIGNMENT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 生成word文件</span></span><br><span class=\"line\">        doc = docx.Document()</span><br><span class=\"line\">        <span class=\"comment\"># 设置所有字体为宋体</span></span><br><span class=\"line\">        doc.styles[<span class=\"string\">&#x27;Normal&#x27;</span>].font.name = <span class=\"string\">u&#x27;宋体&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        doc.styles[<span class=\"string\">&#x27;Normal&#x27;</span>]._element.rPr.rFonts.<span class=\"built_in\">set</span>(qn(<span class=\"string\">&#x27;w:eastAsia&#x27;</span>), <span class=\"string\">u&#x27;宋体&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 设置所有段落的行距为1.5倍</span></span><br><span class=\"line\">        doc.styles[<span class=\"string\">&#x27;Normal&#x27;</span>].paragraph_format.line_spacing = <span class=\"number\">1.5</span></span><br><span class=\"line\">        <span class=\"comment\"># 设置</span></span><br><span class=\"line\">        title = doc.add_paragraph(<span class=\"string\">&quot;浙江工业大学耗材入库单&quot;</span>, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 设置标题字体大小</span></span><br><span class=\"line\">        title.runs[<span class=\"number\">0</span>].font.size = Pt(<span class=\"number\">18</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 加粗</span></span><br><span class=\"line\">        title.runs[<span class=\"number\">0</span>].font.bold = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"comment\"># 设置标题居中</span></span><br><span class=\"line\">        title.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 添加当天时间</span></span><br><span class=\"line\">        today = datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y年%m月%d日&#x27;</span>)</span><br><span class=\"line\">        today = doc.add_paragraph(today, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\">        today.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 添加部门公章</span></span><br><span class=\"line\">        doc.add_paragraph(<span class=\"string\">&quot;部门（公章）：\t\t\t\t\t\t\t单位：\t元&quot;</span>, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 设置表格</span></span><br><span class=\"line\">        table = doc.add_table(rows=<span class=\"number\">1</span>, cols=<span class=\"number\">7</span>, style=<span class=\"string\">&#x27;Table Grid&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 左下</span></span><br><span class=\"line\">        table.alignment = WD_ALIGN_VERTICAL.CENTER</span><br><span class=\"line\">        <span class=\"comment\"># table.alignment = </span></span><br><span class=\"line\">        <span class=\"comment\"># table.alignment = WD_TABLE_ALIGNMENT.LEFT</span></span><br><span class=\"line\">        <span class=\"comment\"># table.alignment = WD_TABLE_ALIGNMENT.BOTTOM</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 根据内容自动调整列宽</span></span><br><span class=\"line\">        <span class=\"comment\"># table.autofit = True</span></span><br><span class=\"line\">        <span class=\"comment\"># table.autofitcontent = True</span></span><br><span class=\"line\">        <span class=\"comment\"># 设置每一列的宽度</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">1</span>).width = Inches(<span class=\"number\">4</span>)</span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">2</span>).width = Inches(<span class=\"number\">3</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 设置 首行</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">0</span>).text = <span class=\"string\">&#x27;供货单位&#x27;</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">1</span>).text = self.company</span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">2</span>).text = <span class=\"string\">&#x27;入库日期&#x27;</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">3</span>).text = self.order_date</span><br><span class=\"line\">        <span class=\"comment\"># 合并单元格</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">3</span>).merge(table.cell(<span class=\"number\">0</span>, <span class=\"number\">4</span>))</span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">5</span>).text = <span class=\"string\">&#x27;入库单号&#x27;</span></span><br><span class=\"line\">        table.cell(<span class=\"number\">0</span>, <span class=\"number\">6</span>).text = self.order_num</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 表格 根据内容自动调整</span></span><br><span class=\"line\">        table.allow_autofit = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        hdr_cells = table.add_row().cells</span><br><span class=\"line\">        hdr_cells[<span class=\"number\">0</span>].text = <span class=\"string\">&#x27;序号&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">1</span>].text = <span class=\"string\">&#x27;耗材名称&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">2</span>].text = <span class=\"string\">&#x27;规格型号&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">3</span>].text = <span class=\"string\">&#x27;单位&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">4</span>].text = <span class=\"string\">&#x27;数量&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">5</span>].text = <span class=\"string\">&#x27;单价&#x27;</span></span><br><span class=\"line\">        hdr_cells[<span class=\"number\">6</span>].text = <span class=\"string\">&#x27;金额&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> index,i <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(self.commodity_list):</span><br><span class=\"line\">            row_cells = table.add_row().cells</span><br><span class=\"line\">            row_cells[<span class=\"number\">0</span>].text = <span class=\"built_in\">str</span>(index+<span class=\"number\">1</span>)</span><br><span class=\"line\">            row_cells[<span class=\"number\">1</span>].text = i.name</span><br><span class=\"line\">            row_cells[<span class=\"number\">2</span>].text = i.<span class=\"built_in\">type</span></span><br><span class=\"line\">            row_cells[<span class=\"number\">3</span>].text = i.unit</span><br><span class=\"line\">            row_cells[<span class=\"number\">4</span>].text = <span class=\"built_in\">str</span>(i.num)</span><br><span class=\"line\">            row_cells[<span class=\"number\">5</span>].text = <span class=\"built_in\">str</span>(i.price)</span><br><span class=\"line\">            row_cells[<span class=\"number\">6</span>].text = <span class=\"built_in\">str</span>(i.total_price)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 合计行</span></span><br><span class=\"line\">        row_cells = table.add_row().cells</span><br><span class=\"line\">        row_cells[<span class=\"number\">0</span>].text = <span class=\"string\">&#x27;合计&#x27;</span></span><br><span class=\"line\">        <span class=\"comment\"># 合并单元格</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        row_cells[<span class=\"number\">1</span>].text = <span class=\"string\">&#x27;(大写)&#x27;</span></span><br><span class=\"line\">        row_cells[<span class=\"number\">2</span>].merge(row_cells[<span class=\"number\">3</span>]).merge(row_cells[<span class=\"number\">4</span>]).text = self.c_price</span><br><span class=\"line\">        row_cells[<span class=\"number\">5</span>].text = <span class=\"string\">&#x27;(小写)&#x27;</span></span><br><span class=\"line\">        row_cells[<span class=\"number\">6</span>].text = <span class=\"built_in\">str</span>(self.total_price)</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 添加制表等</span></span><br><span class=\"line\">        doc.add_paragraph(<span class=\"string\">&quot;制表（保管）：\t\t\t采购：\t\t\t入库验收：&quot;</span>, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        last = doc.add_paragraph(</span><br><span class=\"line\">            <span class=\"string\">&quot;第一联：存根联\t第二联：财务\t第三联：供货单位（采购）\t第四联：验收人&quot;</span>, style=<span class=\"string\">&#x27;Normal&#x27;</span>)</span><br><span class=\"line\">        last.runs[<span class=\"number\">0</span>].font.size = Pt(<span class=\"number\">10</span>)</span><br><span class=\"line\">        last.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER</span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 保存文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">        doc.save(<span class=\"string\">&#x27;invoice/word/&#x27;</span>+<span class=\"built_in\">str</span>(self.total_price)+self.company+self.order_date+<span class=\"string\">&#x27;.docx&#x27;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">get_file_content</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(self.pdf_file_path, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fp.read()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">get_pic_content</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(self.pdf_file_path.replace(<span class=\"string\">&#x27;.pdf&#x27;</span>,<span class=\"string\">&#x27;.jpg&#x27;</span>), <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fp.read()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 获取pdf页码</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">get_pdf_num</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        pdfFileObj = <span class=\"built_in\">open</span>(self.pdf_file_path, <span class=\"string\">&#x27;rb&#x27;</span>)</span><br><span class=\"line\">        pdfReader = pdf.PdfFileReader(pdfFileObj)</span><br><span class=\"line\">        num = pdfReader.numPages</span><br><span class=\"line\">        <span class=\"keyword\">return</span> num</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">cp</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"comment\"># 复制并重命名pdf文件</span></span><br><span class=\"line\">        shutil.copy(self.pdf_file_path, <span class=\"string\">&#x27;invoice/pdf/&#x27;</span>+<span class=\"built_in\">str</span>(self.total_price)+self.company+self.order_date+<span class=\"string\">&#x27;.pdf&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 删除原pdf文件</span></span><br><span class=\"line\">        os.remove(self.pdf_file_path)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">deal</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        self.ocr()</span><br><span class=\"line\">        <span class=\"comment\"># 捕捉异常</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            self.handle_json()</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(e, <span class=\"string\">&#x27;json文件处理失败&#x27;</span>)</span><br><span class=\"line\">            <span class=\"comment\"># 创建错误日志</span></span><br><span class=\"line\">            <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;invoice/log/error-&#123;&#125;.log&#x27;</span>.<span class=\"built_in\">format</span>(datetime.now().strftime(<span class=\"string\">&#x27;%Y年%m月%d日%H-%M&#x27;</span>)), <span class=\"string\">&#x27;a&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                f.write(self.pdf_file_path+<span class=\"string\">&#x27;  &#x27;</span>+<span class=\"built_in\">str</span>(e) +</span><br><span class=\"line\">                        <span class=\"string\">&#x27;\\r\\n&#x27;</span>+<span class=\"built_in\">str</span>(self.json)+<span class=\"string\">&#x27;\\r\\n&#x27;</span>)</span><br><span class=\"line\">            <span class=\"comment\">#print(e)</span></span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;处理json文件出错&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\"># 抛出异常</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\">#print(&#x27;处理json文件成功&#x27;)</span></span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;处理json文件成功&#x27;</span>,self.pdf_file_path)</span><br><span class=\"line\">            <span class=\"comment\"># 创建成功日志</span></span><br><span class=\"line\">            <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;invoice/log/success-&#123;&#125;.log&#x27;</span>.<span class=\"built_in\">format</span>(datetime.now().strftime(<span class=\"string\">&#x27;%Y年%m月%d日%H-%M&#x27;</span>)), <span class=\"string\">&#x27;a&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                f.write(self.pdf_file_path+<span class=\"string\">&#x27;\\r\\n&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        self.generate_word()</span><br><span class=\"line\">        self.cp()</span><br><span class=\"line\">        <span class=\"comment\"># options = &#123;&#125;</span></span><br><span class=\"line\">        <span class=\"comment\"># options[&#x27;pdf_file_num&#x27;] = get_pdf_num(pdf_file_path)</span></span><br><span class=\"line\">        <span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file, options)</span></span><br><span class=\"line\">        <span class=\"comment\"># # 保存json数据</span></span><br><span class=\"line\">        <span class=\"comment\"># with open(&#x27;invoice/1.json&#x27;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">        <span class=\"comment\">#     json.dump(res_pdf, f, ensure_ascii=False, indent=4)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">dealdebug</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        self.ocr()</span><br><span class=\"line\">        <span class=\"comment\"># 捕捉异常</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        self.handle_json()</span><br><span class=\"line\">        </span><br><span class=\"line\"></span><br><span class=\"line\">        self.generate_word()</span><br><span class=\"line\">        <span class=\"comment\"># options = &#123;&#125;</span></span><br><span class=\"line\">        <span class=\"comment\"># options[&#x27;pdf_file_num&#x27;] = get_pdf_num(pdf_file_path)</span></span><br><span class=\"line\">        <span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file, options)</span></span><br><span class=\"line\">        <span class=\"comment\"># # 保存json数据</span></span><br><span class=\"line\">        <span class=\"comment\"># with open(&#x27;invoice/1.json&#x27;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">        <span class=\"comment\">#     json.dump(res_pdf, f, ensure_ascii=False, indent=4)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># read json</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># def read_json(file_path):</span></span><br><span class=\"line\"><span class=\"comment\">#     with open(file_path, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\"><span class=\"comment\">#         json_data = json.load(f)</span></span><br><span class=\"line\"><span class=\"comment\">#         handle_json(json_data)</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> get_pdffiles(<span class=\"string\">&#x27;invoice/new&#x27;</span>):</span><br><span class=\"line\">        WarehouseReceipt(i).deal()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">#WarehouseReceipt(&#x27;invoice/new/202205171971483062.pdf&#x27;).dealdebug()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># WarehouseReceipt(&#x27;invoice\\new\\202209102153729425.pdf&#x27;).deal()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># wh1 = WarehouseReceipt(&#x27;invoice/invoice.pdf&#x27;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># with open(&#x27;invoice/invoice.json&#x27;, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">    <span class=\"comment\">#     wh1.json = json.load(f)</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.ocr()</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.handle_json()</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.deal()</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.handle_json()</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># wh1 = WarehouseReceipt()</span></span><br><span class=\"line\">    <span class=\"comment\"># with open(&#x27;invoice/invoice.json&#x27;, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">    <span class=\"comment\">#     wh1.json = json.load(f)</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.handle_json()</span></span><br><span class=\"line\">    <span class=\"comment\"># wh1.generate_word()</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># read_json(&#x27;invoice/invoice.json&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\"># read_json(&#x27;invoice/1.json&#x27;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># pdf_file_path = &#x27;invoice/1.pdf&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\"># pdf_file = get_file_content(pdf_file_path)</span></span><br><span class=\"line\">    <span class=\"comment\"># options = &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># options[&#x27;pdf_file_num&#x27;] = get_pdf_num(pdf_file_path)</span></span><br><span class=\"line\">    <span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file, options)</span></span><br><span class=\"line\">    <span class=\"comment\"># # 保存json数据</span></span><br><span class=\"line\">    <span class=\"comment\"># with open(&#x27;invoice/1.json&#x27;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class=\"line\">    <span class=\"comment\">#     json.dump(res_pdf, f, ensure_ascii=False, indent=4)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取json数据(测试用)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 调用增值税发票识别</span></span><br><span class=\"line\"><span class=\"comment\"># res_image = client.vatInvoice(image)</span></span><br><span class=\"line\"><span class=\"comment\"># res_url = client.vatInvoiceUrl(url)</span></span><br><span class=\"line\"><span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_image)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_url)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_pdf)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果有可选参数</span></span><br><span class=\"line\"><span class=\"comment\"># options = &#123;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># options[&#x27;pdf_file_num&#x27;] = get_invoice_num(file_path)</span></span><br><span class=\"line\"><span class=\"comment\"># res_image = client.vatInvoice(image, options)</span></span><br><span class=\"line\"><span class=\"comment\"># res_url = client.vatInvoiceUrl(url, options)</span></span><br><span class=\"line\"><span class=\"comment\"># res_pdf = client.vatInvoicePdf(pdf_file, options)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_image)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_url)</span></span><br><span class=\"line\"><span class=\"comment\"># #print(res_pdf)</span></span><br></pre></td></tr></table></figure>\n</div></details>","categories":[],"tags":[{"name":"Python","path":"api/tags/Python.json"},{"name":"OCR","path":"api/tags/OCR.json"}]}
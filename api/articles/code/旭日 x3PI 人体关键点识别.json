{"title":"旭日 x3PI RealSense人体关键点识别","slug":"code/旭日 x3PI 人体关键点识别","date":"2023-05-28T10:16:13.844Z","updated":"2023-05-28T10:16:13.844Z","comments":true,"path":"api/articles/code/旭日 x3PI 人体关键点识别.json","excerpt":null,"covers":["https://image.wxydejoy.top/utools/1685101433236_ojwjf9ncpghqr0z3.png","https://image.wxydejoy.top/utools/1685102218857_03dwsrnjm02gsp2w.png"],"content":"<!--\n * @Author: weiekko weiekko@gmail.com\n * @Date: 2023-05-26 19:40:31\n * @LastEditors: weiekko weiekko@gmail.com\n * @LastEditTime: 2023-05-26 20:29:30\n * @FilePath: \\blog\\source\\_posts\\code\\旭日 x3PI 人体关键点识别.md\n * @Description: \n * \n * Copyright (c) 2023 by weiekko weiekko@gmail.com, All Rights Reserved. \n-->\n<h2 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h2><p>简单介绍一下我的目标</p>\n<p>获取部分人体关键点的空间坐标 控制双臂机器人进行拥抱</p>\n<h2 id=\"首次尝试\"><a href=\"#首次尝试\" class=\"headerlink\" title=\"首次尝试\"></a>首次尝试</h2><p>2022.11 开始做识别部分的内容，开始挑选硬件<br>这是当时小组会的PPT<br><img src=\"https://image.wxydejoy.top/utools/1685101433236_ojwjf9ncpghqr0z3.png\"></p>\n<p>X3就不用多说了 非常强大 </p>\n<h2 id=\"初次接触人体关键点识别\"><a href=\"#初次接触人体关键点识别\" class=\"headerlink\" title=\"初次接触人体关键点识别\"></a>初次接触人体关键点识别</h2><p>刚开始是拿了一个普通的USB摄像头进行识别，但是摄像头的输出像素格式是YUYV，当时关键点识别还只能用mjpeg的USB摄像头或者MIPI的摄像头，于是乎买了官方的MIPI进行尝试</p>\n<p>效果确实不错，但是我不光要关键点的二维坐标，还要三维坐标，这里就需要深度相机了</p>\n<p>实验室刚好有一台Intel的深度相机435，折腾了好久，因为并不熟悉这些东西，最后也没折腾出来</p>\n<p>仔细想想，机器人头上装俩摄像头就很奇怪，想想就脑壳痛。</p>\n<p>当时问群里的开发人员，他们说这个相机暂时不支持，后面可能会支持。其实当时已经有codec模块了，但是好像没有文档，反正是没找到。</p>\n<p>所以转去了用笔记本做主控，但是因为一些结构上的原因我又回来了 </p>\n<p>其实也就花了两天的时间，比我移植ALPHAPOSE快多了</p>\n<p><img src=\"https://image.wxydejoy.top/utools/1685102218857_03dwsrnjm02gsp2w.png\"></p>\n<h2 id=\"RealSense-人体关键点识别\"><a href=\"#RealSense-人体关键点识别\" class=\"headerlink\" title=\"RealSense 人体关键点识别\"></a>RealSense 人体关键点识别</h2><p>先讲一下整体思路</p>\n<p>Realsense node发布的是rgb格式的图像，使用hobot_codec把rgb转成jpeg jpeg转nv12（rgb8好像不能转nv12 我也不知道为什么 程序说的）,最后nv12送给mono2d_body_detection 就可以了</p>\n<h3 id=\"安装realsense2-SDK\"><a href=\"#安装realsense2-SDK\" class=\"headerlink\" title=\"安装realsense2 SDK\"></a>安装realsense2 SDK</h3><h4 id=\"设置网络环境\"><a href=\"#设置网络环境\" class=\"headerlink\" title=\"设置网络环境\"></a>设置网络环境</h4><p>这里因为网络原因需要设置一下GITHUB的代理的host，不然无法访问。</p>\n<p>打开<a href=\"https://www.ipaddress.com/\">https://www.ipaddress.com/</a> 输入raw.githubusercontent.com 查询IP地址 找不到就一直往下滑，直到找到</p>\n<p>把找到的ip按这个格式保存好</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">140.82.112.3 github.com</span><br><span class=\"line\">185.199.108.133 raw.githubusercontent.com</span><br><span class=\"line\">185.199.109.133 raw.githubusercontent.com</span><br><span class=\"line\">185.199.110.133 raw.githubusercontent.com</span><br><span class=\"line\">185.199.111.133 raw.githubusercontent.com</span><br></pre></td></tr></table></figure>\n\n<p>编辑hosts文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vim /etc/hosts</span><br><span class=\"line\"><span class=\"comment\"># 重启网络</span></span><br><span class=\"line\">/etc/init.d/networking restart </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ping一下试试</span></span><br><span class=\"line\">ping raw.githubusercontent.com</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加ROS-apt源\"><a href=\"#添加ROS-apt源\" class=\"headerlink\" title=\"添加ROS apt源\"></a>添加ROS apt源</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update &amp;&amp; sudo apt install curl gnupg2 lsb-release</span><br><span class=\"line\">sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key  -o /usr/share/keyrings/ros-archive-keyring.gpg</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;deb [arch=<span class=\"subst\">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu <span class=\"subst\">$(source /etc/os-release &amp;&amp; echo $UBUNTU_CODENAME)</span> main&quot;</span> | sudo <span class=\"built_in\">tee</span> /etc/apt/sources.list.d/ros2.list &gt; /dev/null</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装Realsense-SDK\"><a href=\"#安装Realsense-SDK\" class=\"headerlink\" title=\"安装Realsense  SDK\"></a>安装Realsense  SDK</h4><p>这一步因为网络原因可能会比较漫长，耐心等待，不如起来活动活动吃个饭。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示ROS当前版本，如果显示为空，请source /opt/tros/setup.bash</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$ROS_DISTRO</span> </span><br><span class=\"line\"><span class=\"comment\"># 安装RealSense SDK</span></span><br><span class=\"line\">sudo apt-get install ros-<span class=\"variable\">$ROS_DISTRO</span>-librealsense2* -y </span><br><span class=\"line\"><span class=\"comment\"># 安装RealSense ros wrapper</span></span><br><span class=\"line\">sudo apt-get install ros-<span class=\"variable\">$ROS_DISTRO</span>-realsense2-camera -y</span><br><span class=\"line\">sudo apt-get install ros-<span class=\"variable\">$ROS_DISTRO</span>-realsense2-description -y</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"建立软连接\"><a href=\"#建立软连接\" class=\"headerlink\" title=\"建立软连接\"></a>建立软连接</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/tros</span><br><span class=\"line\"><span class=\"comment\">## 使用/opt/tros目录下的create_soft_link.py创建ROS package至tros.b的软连接</span></span><br><span class=\"line\">sudo python3 create_soft_link.py --foxy /opt/ros/foxy/ --tros /opt/tros/</span><br></pre></td></tr></table></figure>\n\n<p>到这里Realsense2 SDK就安装完成了</p>\n<h4 id=\"运行测试\"><a href=\"#运行测试\" class=\"headerlink\" title=\"运行测试\"></a>运行测试</h4><p>运行前要先：</p>\n<p><code>source /opt/ros/foxy/setup.bash</code></p>\n<p>然后：</p>\n<p><code>source /opt/tros/setup.bash </code></p>\n<p>运行程序：</p>\n<p><code>ros2 launch realsense2_camera rs_launch.py depth_module.profile:=640x480x15 </code></p>\n<p>这里要感谢一下王卓大佬</p>\n<h3 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h3><p>这里我写了个脚本，保存为.sh文件，然后运行就好了，当然你也可以一步步运行看看哪里出错了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;设置ros2环境变量&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /opt/ros/foxy/setup.bash</span><br><span class=\"line\"><span class=\"built_in\">source</span> /opt/tros/setup.bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  realsense 节点&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">ros2 launch realsense2_camera rs_launch.py depth_module.profile:=640x480x15 &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  rgb8 2 jpeg 节点&#x27;</span></span><br><span class=\"line\">ros2 run hobot_codec hobot_codec_republish --ros-args -p channel:=0 -p in_mode:=ros -p in_format:=rgb8 -p out_mode:=ros -p out_format:=jpeg -p sub_topic:=/camera/color/image_raw -p  pub_topic:=/image_jpeg --log-level error &amp;</span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  jpeg 2 nv12 节点&#x27;</span></span><br><span class=\"line\">ros2 run hobot_codec hobot_codec_republish --ros-args -p channel:=1 -p in_mode:=ros -p in_format:=jpeg -p out_mode:=shared_mem -p out_format:=nv12 -p sub_topic:=/image_jpeg -p  pub_topic:=/hbmem_img --log-level error &amp;</span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  websocket 节点&#x27;</span></span><br><span class=\"line\">ros2 run websocket websocket --ros-args -p image_topic:=/image_jpeg -p image_type:=mjpeg -p smart_topic:=/hobot_mono2d_body_detection --log-level error  &amp;</span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  mono2d_body_detection 节点&#x27;</span></span><br><span class=\"line\">ros2 run mono2d_body_detection mono2d_body_detection --log-level error &amp;</span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  websocket 节点&#x27;</span></span><br><span class=\"line\">ros2 launch websocket hobot_websocket.launch.py &amp;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是  rgb8(ros) -&gt; jpeg(ros) -&gt; nv12(shared_mem) -&gt; mono2d_body_detection</p>\n<h3 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h3><p>安装realsense SDK参考：<a href=\"https://c-gitlab.horizon.ai/HHP/box/hobot_slam/orb_slam3\">https://c-gitlab.horizon.ai/HHP/box/hobot_slam/orb_slam3</a></p>\n<p>软链接参考：<a href=\"https://developer.horizon.ai/api/v1/fileData/TogetherROS/quick_start/install_use_ros_pkg.html\">https://developer.horizon.ai/api/v1/fileData/TogetherROS/quick_start/install_use_ros_pkg.html</a></p>\n<p>codec参考：<a href=\"https://c-gitlab.horizon.ai/HHP/box/hobot_codec\">https://c-gitlab.horizon.ai/HHP/box/hobot_codec</a></p>\n<h2 id=\"注\"><a href=\"#注\" class=\"headerlink\" title=\"注\"></a>注</h2><p>如果有哪里有问题，包括我的问题和你运行的问题，欢迎评论指出，我会及时修改</p>\n<p>这里还要感谢一下王卓大佬</p>\n<p>关于realsense 的文档藏的也太深了。。。</p>\n<h2 id=\"To-Do\"><a href=\"#To-Do\" class=\"headerlink\" title=\"To Do\"></a>To Do</h2><p>深度信息获取与计算<br>表情视频切换播放</p>\n","more":"<!--\n * @Author: weiekko weiekko@gmail.com\n * @Date: 2023-05-26 19:40:31\n * @LastEditors: weiekko weiekko@gmail.com\n * @LastEditTime: 2023-05-26 20:29:30\n * @FilePath: \\blog\\source\\_posts\\code\\旭日 x3PI 人体关键点识别.md\n * @Description: \n * \n * Copyright (c) 2023 by weiekko weiekko@gmail.com, All Rights Reserved. \n-->\n<h2 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h2><p>简单介绍一下我的目标</p>\n<p>获取部分人体关键点的空间坐标 控制双臂机器人进行拥抱</p>\n<h2 id=\"首次尝试\"><a href=\"#首次尝试\" class=\"headerlink\" title=\"首次尝试\"></a>首次尝试</h2><p>2022.11 开始做识别部分的内容，开始挑选硬件<br>这是当时小组会的PPT<br><img src=\"https://image.wxydejoy.top/utools/1685101433236_ojwjf9ncpghqr0z3.png\"></p>\n<p>X3就不用多说了 非常强大 </p>\n<h2 id=\"初次接触人体关键点识别\"><a href=\"#初次接触人体关键点识别\" class=\"headerlink\" title=\"初次接触人体关键点识别\"></a>初次接触人体关键点识别</h2><p>刚开始是拿了一个普通的USB摄像头进行识别，但是摄像头的输出像素格式是YUYV，当时关键点识别还只能用mjpeg的USB摄像头或者MIPI的摄像头，于是乎买了官方的MIPI进行尝试</p>\n<p>效果确实不错，但是我不光要关键点的二维坐标，还要三维坐标，这里就需要深度相机了</p>\n<p>实验室刚好有一台Intel的深度相机435，折腾了好久，因为并不熟悉这些东西，最后也没折腾出来</p>\n<p>仔细想想，机器人头上装俩摄像头就很奇怪，想想就脑壳痛。</p>\n<p>当时问群里的开发人员，他们说这个相机暂时不支持，后面可能会支持。其实当时已经有codec模块了，但是好像没有文档，反正是没找到。</p>\n<p>所以转去了用笔记本做主控，但是因为一些结构上的原因我又回来了 </p>\n<p>其实也就花了两天的时间，比我移植ALPHAPOSE快多了</p>\n<p><img src=\"https://image.wxydejoy.top/utools/1685102218857_03dwsrnjm02gsp2w.png\"></p>\n<h2 id=\"RealSense-人体关键点识别\"><a href=\"#RealSense-人体关键点识别\" class=\"headerlink\" title=\"RealSense 人体关键点识别\"></a>RealSense 人体关键点识别</h2><p>先讲一下整体思路</p>\n<p>Realsense node发布的是rgb格式的图像，使用hobot_codec把rgb转成jpeg jpeg转nv12（rgb8好像不能转nv12 我也不知道为什么 程序说的）,最后nv12送给mono2d_body_detection 就可以了</p>\n<h3 id=\"安装realsense2-SDK\"><a href=\"#安装realsense2-SDK\" class=\"headerlink\" title=\"安装realsense2 SDK\"></a>安装realsense2 SDK</h3><h4 id=\"设置网络环境\"><a href=\"#设置网络环境\" class=\"headerlink\" title=\"设置网络环境\"></a>设置网络环境</h4><p>这里因为网络原因需要设置一下GITHUB的代理的host，不然无法访问。</p>\n<p>打开<a href=\"https://www.ipaddress.com/\">https://www.ipaddress.com/</a> 输入raw.githubusercontent.com 查询IP地址 找不到就一直往下滑，直到找到</p>\n<p>把找到的ip按这个格式保存好</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">140.82.112.3 github.com</span><br><span class=\"line\">185.199.108.133 raw.githubusercontent.com</span><br><span class=\"line\">185.199.109.133 raw.githubusercontent.com</span><br><span class=\"line\">185.199.110.133 raw.githubusercontent.com</span><br><span class=\"line\">185.199.111.133 raw.githubusercontent.com</span><br></pre></td></tr></table></figure>\n\n<p>编辑hosts文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vim /etc/hosts</span><br><span class=\"line\"><span class=\"comment\"># 重启网络</span></span><br><span class=\"line\">/etc/init.d/networking restart </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ping一下试试</span></span><br><span class=\"line\">ping raw.githubusercontent.com</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加ROS-apt源\"><a href=\"#添加ROS-apt源\" class=\"headerlink\" title=\"添加ROS apt源\"></a>添加ROS apt源</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update &amp;&amp; sudo apt install curl gnupg2 lsb-release</span><br><span class=\"line\">sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key  -o /usr/share/keyrings/ros-archive-keyring.gpg</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;deb [arch=<span class=\"subst\">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu <span class=\"subst\">$(source /etc/os-release &amp;&amp; echo $UBUNTU_CODENAME)</span> main&quot;</span> | sudo <span class=\"built_in\">tee</span> /etc/apt/sources.list.d/ros2.list &gt; /dev/null</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装Realsense-SDK\"><a href=\"#安装Realsense-SDK\" class=\"headerlink\" title=\"安装Realsense  SDK\"></a>安装Realsense  SDK</h4><p>这一步因为网络原因可能会比较漫长，耐心等待，不如起来活动活动吃个饭。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示ROS当前版本，如果显示为空，请source /opt/tros/setup.bash</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$ROS_DISTRO</span> </span><br><span class=\"line\"><span class=\"comment\"># 安装RealSense SDK</span></span><br><span class=\"line\">sudo apt-get install ros-<span class=\"variable\">$ROS_DISTRO</span>-librealsense2* -y </span><br><span class=\"line\"><span class=\"comment\"># 安装RealSense ros wrapper</span></span><br><span class=\"line\">sudo apt-get install ros-<span class=\"variable\">$ROS_DISTRO</span>-realsense2-camera -y</span><br><span class=\"line\">sudo apt-get install ros-<span class=\"variable\">$ROS_DISTRO</span>-realsense2-description -y</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"建立软连接\"><a href=\"#建立软连接\" class=\"headerlink\" title=\"建立软连接\"></a>建立软连接</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/tros</span><br><span class=\"line\"><span class=\"comment\">## 使用/opt/tros目录下的create_soft_link.py创建ROS package至tros.b的软连接</span></span><br><span class=\"line\">sudo python3 create_soft_link.py --foxy /opt/ros/foxy/ --tros /opt/tros/</span><br></pre></td></tr></table></figure>\n\n<p>到这里Realsense2 SDK就安装完成了</p>\n<h4 id=\"运行测试\"><a href=\"#运行测试\" class=\"headerlink\" title=\"运行测试\"></a>运行测试</h4><p>运行前要先：</p>\n<p><code>source /opt/ros/foxy/setup.bash</code></p>\n<p>然后：</p>\n<p><code>source /opt/tros/setup.bash </code></p>\n<p>运行程序：</p>\n<p><code>ros2 launch realsense2_camera rs_launch.py depth_module.profile:=640x480x15 </code></p>\n<p>这里要感谢一下王卓大佬</p>\n<h3 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h3><p>这里我写了个脚本，保存为.sh文件，然后运行就好了，当然你也可以一步步运行看看哪里出错了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;设置ros2环境变量&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /opt/ros/foxy/setup.bash</span><br><span class=\"line\"><span class=\"built_in\">source</span> /opt/tros/setup.bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  realsense 节点&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">ros2 launch realsense2_camera rs_launch.py depth_module.profile:=640x480x15 &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  rgb8 2 jpeg 节点&#x27;</span></span><br><span class=\"line\">ros2 run hobot_codec hobot_codec_republish --ros-args -p channel:=0 -p in_mode:=ros -p in_format:=rgb8 -p out_mode:=ros -p out_format:=jpeg -p sub_topic:=/camera/color/image_raw -p  pub_topic:=/image_jpeg --log-level error &amp;</span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  jpeg 2 nv12 节点&#x27;</span></span><br><span class=\"line\">ros2 run hobot_codec hobot_codec_republish --ros-args -p channel:=1 -p in_mode:=ros -p in_format:=jpeg -p out_mode:=shared_mem -p out_format:=nv12 -p sub_topic:=/image_jpeg -p  pub_topic:=/hbmem_img --log-level error &amp;</span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  websocket 节点&#x27;</span></span><br><span class=\"line\">ros2 run websocket websocket --ros-args -p image_topic:=/image_jpeg -p image_type:=mjpeg -p smart_topic:=/hobot_mono2d_body_detection --log-level error  &amp;</span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  mono2d_body_detection 节点&#x27;</span></span><br><span class=\"line\">ros2 run mono2d_body_detection mono2d_body_detection --log-level error &amp;</span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;启动ros2  websocket 节点&#x27;</span></span><br><span class=\"line\">ros2 launch websocket hobot_websocket.launch.py &amp;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是  rgb8(ros) -&gt; jpeg(ros) -&gt; nv12(shared_mem) -&gt; mono2d_body_detection</p>\n<h3 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h3><p>安装realsense SDK参考：<a href=\"https://c-gitlab.horizon.ai/HHP/box/hobot_slam/orb_slam3\">https://c-gitlab.horizon.ai/HHP/box/hobot_slam/orb_slam3</a></p>\n<p>软链接参考：<a href=\"https://developer.horizon.ai/api/v1/fileData/TogetherROS/quick_start/install_use_ros_pkg.html\">https://developer.horizon.ai/api/v1/fileData/TogetherROS/quick_start/install_use_ros_pkg.html</a></p>\n<p>codec参考：<a href=\"https://c-gitlab.horizon.ai/HHP/box/hobot_codec\">https://c-gitlab.horizon.ai/HHP/box/hobot_codec</a></p>\n<h2 id=\"注\"><a href=\"#注\" class=\"headerlink\" title=\"注\"></a>注</h2><p>如果有哪里有问题，包括我的问题和你运行的问题，欢迎评论指出，我会及时修改</p>\n<p>这里还要感谢一下王卓大佬</p>\n<p>关于realsense 的文档藏的也太深了。。。</p>\n<h2 id=\"To-Do\"><a href=\"#To-Do\" class=\"headerlink\" title=\"To Do\"></a>To Do</h2><p>深度信息获取与计算<br>表情视频切换播放</p>\n","categories":[],"tags":[]}
{"title":"MoneyProgress_win","slug":"post/code/cpp/MoneyProgress_win","date":"2023-04-11T04:08:17.000Z","updated":"2023-04-11T04:08:17.000Z","comments":true,"path":"api/articles/post/code/cpp/MoneyProgress_win.json","excerpt":null,"covers":["https://img.undf.top/image/MoneyProgress_win/20230411122233-2023-04-11.png","https://img.undf.top/image/MoneyProgress_win/20230411122553-2023-04-11.png","https://img.undf.top/image/MoneyProgress_win/20230411123559-2023-04-11.png"],"content":"<h2 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h2><p>前段时间分享了一个MoneyProgress的Mac软件,一直有人在论坛发帖问有没有win版的,恰好最近在看Qt,于是就有了这个项目.</p>\n<p>写这个贴子的目的是为了记录一下开发过程,以及遇到的问题.</p>\n<p>以后可以拿它做参考,也可以给有需要的人提供一些帮助.</p>\n<p>MAC版的项目地址: <a href=\"https://github.com/Lakr233/MoneyProgress\">MoneyProgress</a><br>WIN版的项目地址: <a href=\"https://github.com/wxydejoy/MoneyProgress_win\">MoneyProgress_win</a></p>\n<p>程序很大程度参考了原作者的UI设计,这里再次感谢原作者.</p>\n<h2 id=\"开发环境\"><a href=\"#开发环境\" class=\"headerlink\" title=\"开发环境\"></a>开发环境</h2><ul>\n<li>Windows 10 20H2(这个不是很重要)</li>\n<li>Qt 5.15 with Mingw(这个很重要)</li>\n</ul>\n<h2 id=\"开发过程\"><a href=\"#开发过程\" class=\"headerlink\" title=\"开发过程\"></a>开发过程</h2><p>这块看我的<a href=\"https://github.com/wxydejoy/MoneyProgress_win/commits/main\">commit</a>记录就行了,虽然有点乱,但是基本上都是有用的. </p>\n<p>这里只记录一些比较重要的问题,其他的问题可以参考<a href=\"https://doc.qt.io/qt-5/index.html\">Qt官方文档</a></p>\n<p>多看文档,多看文档,多看文档.</p>\n<h3 id=\"问题1-图片过大\"><a href=\"#问题1-图片过大\" class=\"headerlink\" title=\"问题1: 图片过大\"></a>问题1: 图片过大</h3><p>原作者的图片都是png格式,大小足足有3.27MB,分辨率为1024x1024,应该是自己画的吧.</p>\n<p>刚开始导入图片设置为<code>label</code>设置样式表<code>background-image: url(:/img/avatar.png);</code></p>\n<p>是这样的:</p>\n<p><img src=\"https://img.undf.top/image/MoneyProgress_win/20230411122233-2023-04-11.png\" alt=\"20230411122233-2023-04-11\"></p>\n<p>可以看到图片很大,很奇怪,</p>\n<p>解决办法:</p>\n<p><strong>设置为<code>border-image: url(:/img/avatar.png);</code></strong></p>\n<p><img src=\"https://img.undf.top/image/MoneyProgress_win/20230411122553-2023-04-11.png\" alt=\"20230411122553-2023-04-11\"></p>\n<p>这样它就会自动缩放了.可以通过设置<code>label</code>的<code>width</code>和<code>height</code>来控制图片的大小.</p>\n<h3 id=\"问题2-无法获取到正确的屏幕分辨率\"><a href=\"#问题2-无法获取到正确的屏幕分辨率\" class=\"headerlink\" title=\"问题2: 无法获取到正确的屏幕分辨率\"></a>问题2: 无法获取到正确的屏幕分辨率</h3><p>这个问题是论坛上有人提出来的,我也遇到了.</p>\n<p>原代码为:</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里省略了一些代码</span></span><br><span class=\"line\"><span class=\"comment\">// 获取屏幕分辨率高度</span></span><br><span class=\"line\">QApplication::<span class=\"built_in\">desktop</span>()-&gt;<span class=\"built_in\">width</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>实际获取的不一定就是当前屏幕的分辨率,有时候会获取到错误的值.<br>比如你有多块屏幕,它会获取到所有屏幕的分辨率的和.就很离谱.<br>这就会导致我们的程序在不同的屏幕上显示的效果不一样.<br>任务栏的弹窗就奇奇怪怪的.甚至看不到.</p>\n<p><img src=\"https://img.undf.top/image/MoneyProgress_win/20230411123559-2023-04-11.png\" alt=\"20230411123559-2023-04-11\"></p>\n<p>解决办法:</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里省略了一些代码</span></span><br><span class=\"line\">QApplication::<span class=\"built_in\">screenAt</span>(<span class=\"built_in\">QCursor</span>().<span class=\"built_in\">pos</span>())-&gt;<span class=\"built_in\">geometry</span>().<span class=\"built_in\">width</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>意为获取鼠标所在屏幕的分辨率宽度.非常ok.</p>\n<h3 id=\"问题3-文本无法正常更新\"><a href=\"#问题3-文本无法正常更新\" class=\"headerlink\" title=\"问题3: 文本无法正常更新\"></a>问题3: 文本无法正常更新</h3><p>问题代码:</p>\n<p>因为我想实现每次点击任务栏图标都会弹出一个弹窗,显示当前的挣钱进度,所以我在<code>MoneyProgress</code>类中添加了一个<code>IconMessage</code>类的对象(一个小widget),并且在<code>MoneyProgress</code>类中添加了一个<code>update</code>函数,用来更新弹窗中的文本.<br>同时<code>update</code>还要负责更新主窗口中的文本.所以就有了如下代码</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">MoneyProgress::update</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 这里省略了一些代码</span></span><br><span class=\"line\">    <span class=\"comment\">// 判断两个界面是否可见</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>-&gt;<span class=\"built_in\">isVisible</span>())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ui-&gt;labelMoneyNow-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您当前已经挣了&quot;</span>+QString::<span class=\"built_in\">number</span>(moneyday*progress/<span class=\"number\">1000</span>,<span class=\"string\">&#x27;f&#x27;</span>,<span class=\"number\">1</span>)+<span class=\"string\">&quot;元;&quot;</span>);</span><br><span class=\"line\">        ui-&gt;labelDay-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您一月工作&quot;</span> + QString::<span class=\"built_in\">number</span>(days) + <span class=\"string\">&quot;天;&quot;</span>);</span><br><span class=\"line\">        ui-&gt;labelMoneyDay-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您一天能挣&quot;</span> + QString::<span class=\"built_in\">number</span>(moneyday, <span class=\"string\">&#x27;f&#x27;</span>, <span class=\"number\">1</span>) + <span class=\"string\">&quot;元;&quot;</span>);</span><br><span class=\"line\">        ui-&gt;labelHourDay-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您一天工作&quot;</span> + QString::<span class=\"built_in\">number</span>(hours, <span class=\"string\">&#x27;f&#x27;</span>, <span class=\"number\">1</span>) + <span class=\"string\">&quot;小时;&quot;</span>);</span><br><span class=\"line\">        ui-&gt;labelMoneySecond-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您一秒钟能挣&quot;</span> + QString::<span class=\"built_in\">number</span>(moneysecond, <span class=\"string\">&#x27;f&#x27;</span>, <span class=\"number\">6</span>) + <span class=\"string\">&quot;元;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (iconmessage.<span class=\"built_in\">isVisible</span>())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        iconmessage.<span class=\"built_in\">update</span>(progress, moneyday);</span><br><span class=\"line\">        <span class=\"built_in\">qDebug</span>() &lt;&lt; progress;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>可以看到大致思路就是判断两个界面是否可见,如果可见就更新文本.但是任务栏那个小窗口的文本无法更新,调试发现了一个低级错误</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">update</span>(); <span class=\"comment\">//错误的写法</span></span><br><span class=\"line\">iconmessage.<span class=\"built_in\">show</span>();</span><br><span class=\"line\"><span class=\"comment\">// update(); 把update()放在这里就可以更新了</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>确实很低级</p>\n<h3 id=\"问题4-QSettings-无效\"><a href=\"#问题4-QSettings-无效\" class=\"headerlink\" title=\"问题4: QSettings 无效\"></a>问题4: QSettings 无效</h3><p>这个问题是在保存时间的时候遇到的,我想把设置保存到<code>QSettings</code>里面,但是发现无论怎么设置都无效.<br>在网上逛了半天,发现是因为<code>QSettings</code>只能在构造函数和析构函数中使用,不能在其他函数中使用.</p>\n<p>问题代码:</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//原本设计的是每次设置改变就保存一次,但是发现无效</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">MoneyProgress::on_timeSleepdown_userTimeChanged</span><span class=\"params\">(<span class=\"type\">const</span> QTime &amp;time)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 这里省略了一些代码 settings 是一个QSettings对象,在.h文件中定义</span></span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;sleepDown&quot;</span>, sleepDown);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 保存设置</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>解决办法:</p>\n<p>将<code>QSettings</code>的保存设置放到析构函数中,这样就可以正常使用了.</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">MoneyProgress::~<span class=\"built_in\">MoneyProgress</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\">QSettings <span class=\"title\">settings</span><span class=\"params\">(<span class=\"string\">&quot;MuYin&quot;</span>, <span class=\"string\">&quot;MoneyProgress_win&quot;</span>)</span></span>;</span><br><span class=\"line\">    <span class=\"comment\">// 保存设置</span></span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;money&quot;</span>, money);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;days&quot;</span>, days);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;workUp&quot;</span>, workUp);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;workDown&quot;</span>, workDown);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;sleepUp&quot;</span>, sleepUp);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;sleepDown&quot;</span>, sleepDown);</span><br><span class=\"line\">    <span class=\"comment\">// settings.setValue(&quot;geometry&quot;, this-&gt;saveGeometry());</span></span><br><span class=\"line\">    <span class=\"comment\">// settings.setValue(&quot;windowState&quot;, this-&gt;saveState());</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 保存设置</span></span><br><span class=\"line\">    settings.<span class=\"built_in\">sync</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">delete</span> ui;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"问题5-QSS样式表不会用\"><a href=\"#问题5-QSS样式表不会用\" class=\"headerlink\" title=\"问题5: QSS样式表不会用\"></a>问题5: QSS样式表不会用</h3><p>因为我设置了标题栏隐藏</p>\n<p><code>this-&gt;setWindowFlags(Qt::Dialog | Qt::FramelessWindowHint | Qt::WindowStaysOnTopHint); // 隐藏标题栏</code></p>\n<p>所以一直弄不出来<code>borde</code>的样式,最后发现改<code>centralwidget</code>的<code>border</code>属性就可以了.</p>\n<p>问题代码:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">QWidget &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">255</span>, <span class=\"number\">216</span>, <span class=\"number\">58</span>, <span class=\"number\">225</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">15px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>解决方法</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">QWidget &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">255</span>, <span class=\"number\">216</span>, <span class=\"number\">58</span>, <span class=\"number\">225</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">15px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">QWidget<span class=\"selector-id\">#centralwidget</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">3px</span> solid <span class=\"number\">#ffee6f</span>;</span><br><span class=\"line\">    <span class=\"comment\">/* border-color: rgba(255, 216, 58, 225); */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>css还是不太了解,回头需要好好学习一下.</p>\n<h3 id=\"问题6-程序整体缩放问题\"><a href=\"#问题6-程序整体缩放问题\" class=\"headerlink\" title=\"问题6: 程序整体缩放问题\"></a>问题6: 程序整体缩放问题</h3><p>引用网友的话:</p>\n<blockquote>\n<p>Qt下高分屏的问题，几乎是一场灾难。希望未来 Qt 能有更好的解决方案。</p>\n</blockquote>\n<p>解决方法: 添加 <code>qt/etc/qt.conf</code>文件,注意这是在qrc文件中的路径,它的完整路径是<code>qrc:/qt/etc/qt.conf</code>,网上说一定不要弄错<br>文件内容的意思为不使用QT的缩放功能,而是使用系统的缩放功能</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[Platforms]</span></span><br><span class=\"line\"><span class=\"attr\">WindowsArguments</span> = dpiawareness=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>具体看这个<a href=\"https://github.com/wxydejoy/MoneyProgress_win/commit/76ce3656f6f45008369d1b023bd450f817b59ab3\">commit</a></p>\n<h3 id=\"问题7-QtCreator-无法Debug\"><a href=\"#问题7-QtCreator-无法Debug\" class=\"headerlink\" title=\"问题7: QtCreator 无法Debug\"></a>问题7: QtCreator 无法Debug</h3><p>将build模式从release改为debug就可以了…………………………….</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>项目不大,时间也不算长,大概两三个晚上的样子,但是在这个过程中学到了很多东西,比如说<code>QSettings</code>的使用,<code>QSS</code>的使用,<code>QTimer</code>的使用,<code>QApplication::screenAt(QCursor().pos())-&gt;geometry().width()</code>的使用,以及一些小技巧,比如说<code>QSettings</code>只能在构造函数和析构函数中使用,<code>QSS</code>的<code>border</code>属性要写在<code>centralwidget</code>上,<code>QTimer</code>的<code>start</code>函数可以传入一个参数,表示延迟多久开始计时,<code>QApplication::screenAt(QCursor().pos())-&gt;geometry().width()</code>可以获取鼠标所在屏幕的分辨率宽度等等.</p>\n<p>最后希望大家能够多多支持,如果有什么问题,欢迎指正,可以在评论区留言,我会尽快回复的.</p>\n","more":"<h2 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h2><p>前段时间分享了一个MoneyProgress的Mac软件,一直有人在论坛发帖问有没有win版的,恰好最近在看Qt,于是就有了这个项目.</p>\n<p>写这个贴子的目的是为了记录一下开发过程,以及遇到的问题.</p>\n<p>以后可以拿它做参考,也可以给有需要的人提供一些帮助.</p>\n<p>MAC版的项目地址: <a href=\"https://github.com/Lakr233/MoneyProgress\">MoneyProgress</a><br>WIN版的项目地址: <a href=\"https://github.com/wxydejoy/MoneyProgress_win\">MoneyProgress_win</a></p>\n<p>程序很大程度参考了原作者的UI设计,这里再次感谢原作者.</p>\n<h2 id=\"开发环境\"><a href=\"#开发环境\" class=\"headerlink\" title=\"开发环境\"></a>开发环境</h2><ul>\n<li>Windows 10 20H2(这个不是很重要)</li>\n<li>Qt 5.15 with Mingw(这个很重要)</li>\n</ul>\n<h2 id=\"开发过程\"><a href=\"#开发过程\" class=\"headerlink\" title=\"开发过程\"></a>开发过程</h2><p>这块看我的<a href=\"https://github.com/wxydejoy/MoneyProgress_win/commits/main\">commit</a>记录就行了,虽然有点乱,但是基本上都是有用的. </p>\n<p>这里只记录一些比较重要的问题,其他的问题可以参考<a href=\"https://doc.qt.io/qt-5/index.html\">Qt官方文档</a></p>\n<p>多看文档,多看文档,多看文档.</p>\n<h3 id=\"问题1-图片过大\"><a href=\"#问题1-图片过大\" class=\"headerlink\" title=\"问题1: 图片过大\"></a>问题1: 图片过大</h3><p>原作者的图片都是png格式,大小足足有3.27MB,分辨率为1024x1024,应该是自己画的吧.</p>\n<p>刚开始导入图片设置为<code>label</code>设置样式表<code>background-image: url(:/img/avatar.png);</code></p>\n<p>是这样的:</p>\n<p><img src=\"https://img.undf.top/image/MoneyProgress_win/20230411122233-2023-04-11.png\" alt=\"20230411122233-2023-04-11\"></p>\n<p>可以看到图片很大,很奇怪,</p>\n<p>解决办法:</p>\n<p><strong>设置为<code>border-image: url(:/img/avatar.png);</code></strong></p>\n<p><img src=\"https://img.undf.top/image/MoneyProgress_win/20230411122553-2023-04-11.png\" alt=\"20230411122553-2023-04-11\"></p>\n<p>这样它就会自动缩放了.可以通过设置<code>label</code>的<code>width</code>和<code>height</code>来控制图片的大小.</p>\n<h3 id=\"问题2-无法获取到正确的屏幕分辨率\"><a href=\"#问题2-无法获取到正确的屏幕分辨率\" class=\"headerlink\" title=\"问题2: 无法获取到正确的屏幕分辨率\"></a>问题2: 无法获取到正确的屏幕分辨率</h3><p>这个问题是论坛上有人提出来的,我也遇到了.</p>\n<p>原代码为:</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里省略了一些代码</span></span><br><span class=\"line\"><span class=\"comment\">// 获取屏幕分辨率高度</span></span><br><span class=\"line\">QApplication::<span class=\"built_in\">desktop</span>()-&gt;<span class=\"built_in\">width</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>实际获取的不一定就是当前屏幕的分辨率,有时候会获取到错误的值.<br>比如你有多块屏幕,它会获取到所有屏幕的分辨率的和.就很离谱.<br>这就会导致我们的程序在不同的屏幕上显示的效果不一样.<br>任务栏的弹窗就奇奇怪怪的.甚至看不到.</p>\n<p><img src=\"https://img.undf.top/image/MoneyProgress_win/20230411123559-2023-04-11.png\" alt=\"20230411123559-2023-04-11\"></p>\n<p>解决办法:</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里省略了一些代码</span></span><br><span class=\"line\">QApplication::<span class=\"built_in\">screenAt</span>(<span class=\"built_in\">QCursor</span>().<span class=\"built_in\">pos</span>())-&gt;<span class=\"built_in\">geometry</span>().<span class=\"built_in\">width</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>意为获取鼠标所在屏幕的分辨率宽度.非常ok.</p>\n<h3 id=\"问题3-文本无法正常更新\"><a href=\"#问题3-文本无法正常更新\" class=\"headerlink\" title=\"问题3: 文本无法正常更新\"></a>问题3: 文本无法正常更新</h3><p>问题代码:</p>\n<p>因为我想实现每次点击任务栏图标都会弹出一个弹窗,显示当前的挣钱进度,所以我在<code>MoneyProgress</code>类中添加了一个<code>IconMessage</code>类的对象(一个小widget),并且在<code>MoneyProgress</code>类中添加了一个<code>update</code>函数,用来更新弹窗中的文本.<br>同时<code>update</code>还要负责更新主窗口中的文本.所以就有了如下代码</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">MoneyProgress::update</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 这里省略了一些代码</span></span><br><span class=\"line\">    <span class=\"comment\">// 判断两个界面是否可见</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>-&gt;<span class=\"built_in\">isVisible</span>())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ui-&gt;labelMoneyNow-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您当前已经挣了&quot;</span>+QString::<span class=\"built_in\">number</span>(moneyday*progress/<span class=\"number\">1000</span>,<span class=\"string\">&#x27;f&#x27;</span>,<span class=\"number\">1</span>)+<span class=\"string\">&quot;元;&quot;</span>);</span><br><span class=\"line\">        ui-&gt;labelDay-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您一月工作&quot;</span> + QString::<span class=\"built_in\">number</span>(days) + <span class=\"string\">&quot;天;&quot;</span>);</span><br><span class=\"line\">        ui-&gt;labelMoneyDay-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您一天能挣&quot;</span> + QString::<span class=\"built_in\">number</span>(moneyday, <span class=\"string\">&#x27;f&#x27;</span>, <span class=\"number\">1</span>) + <span class=\"string\">&quot;元;&quot;</span>);</span><br><span class=\"line\">        ui-&gt;labelHourDay-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您一天工作&quot;</span> + QString::<span class=\"built_in\">number</span>(hours, <span class=\"string\">&#x27;f&#x27;</span>, <span class=\"number\">1</span>) + <span class=\"string\">&quot;小时;&quot;</span>);</span><br><span class=\"line\">        ui-&gt;labelMoneySecond-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;您一秒钟能挣&quot;</span> + QString::<span class=\"built_in\">number</span>(moneysecond, <span class=\"string\">&#x27;f&#x27;</span>, <span class=\"number\">6</span>) + <span class=\"string\">&quot;元;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (iconmessage.<span class=\"built_in\">isVisible</span>())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        iconmessage.<span class=\"built_in\">update</span>(progress, moneyday);</span><br><span class=\"line\">        <span class=\"built_in\">qDebug</span>() &lt;&lt; progress;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>可以看到大致思路就是判断两个界面是否可见,如果可见就更新文本.但是任务栏那个小窗口的文本无法更新,调试发现了一个低级错误</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">update</span>(); <span class=\"comment\">//错误的写法</span></span><br><span class=\"line\">iconmessage.<span class=\"built_in\">show</span>();</span><br><span class=\"line\"><span class=\"comment\">// update(); 把update()放在这里就可以更新了</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>确实很低级</p>\n<h3 id=\"问题4-QSettings-无效\"><a href=\"#问题4-QSettings-无效\" class=\"headerlink\" title=\"问题4: QSettings 无效\"></a>问题4: QSettings 无效</h3><p>这个问题是在保存时间的时候遇到的,我想把设置保存到<code>QSettings</code>里面,但是发现无论怎么设置都无效.<br>在网上逛了半天,发现是因为<code>QSettings</code>只能在构造函数和析构函数中使用,不能在其他函数中使用.</p>\n<p>问题代码:</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//原本设计的是每次设置改变就保存一次,但是发现无效</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">MoneyProgress::on_timeSleepdown_userTimeChanged</span><span class=\"params\">(<span class=\"type\">const</span> QTime &amp;time)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 这里省略了一些代码 settings 是一个QSettings对象,在.h文件中定义</span></span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;sleepDown&quot;</span>, sleepDown);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 保存设置</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>解决办法:</p>\n<p>将<code>QSettings</code>的保存设置放到析构函数中,这样就可以正常使用了.</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">MoneyProgress::~<span class=\"built_in\">MoneyProgress</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\">QSettings <span class=\"title\">settings</span><span class=\"params\">(<span class=\"string\">&quot;MuYin&quot;</span>, <span class=\"string\">&quot;MoneyProgress_win&quot;</span>)</span></span>;</span><br><span class=\"line\">    <span class=\"comment\">// 保存设置</span></span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;money&quot;</span>, money);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;days&quot;</span>, days);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;workUp&quot;</span>, workUp);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;workDown&quot;</span>, workDown);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;sleepUp&quot;</span>, sleepUp);</span><br><span class=\"line\">    settings.<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;sleepDown&quot;</span>, sleepDown);</span><br><span class=\"line\">    <span class=\"comment\">// settings.setValue(&quot;geometry&quot;, this-&gt;saveGeometry());</span></span><br><span class=\"line\">    <span class=\"comment\">// settings.setValue(&quot;windowState&quot;, this-&gt;saveState());</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 保存设置</span></span><br><span class=\"line\">    settings.<span class=\"built_in\">sync</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">delete</span> ui;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"问题5-QSS样式表不会用\"><a href=\"#问题5-QSS样式表不会用\" class=\"headerlink\" title=\"问题5: QSS样式表不会用\"></a>问题5: QSS样式表不会用</h3><p>因为我设置了标题栏隐藏</p>\n<p><code>this-&gt;setWindowFlags(Qt::Dialog | Qt::FramelessWindowHint | Qt::WindowStaysOnTopHint); // 隐藏标题栏</code></p>\n<p>所以一直弄不出来<code>borde</code>的样式,最后发现改<code>centralwidget</code>的<code>border</code>属性就可以了.</p>\n<p>问题代码:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">QWidget &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">255</span>, <span class=\"number\">216</span>, <span class=\"number\">58</span>, <span class=\"number\">225</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">15px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>解决方法</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">QWidget &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">255</span>, <span class=\"number\">216</span>, <span class=\"number\">58</span>, <span class=\"number\">225</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">15px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">QWidget<span class=\"selector-id\">#centralwidget</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>);</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">3px</span> solid <span class=\"number\">#ffee6f</span>;</span><br><span class=\"line\">    <span class=\"comment\">/* border-color: rgba(255, 216, 58, 225); */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>css还是不太了解,回头需要好好学习一下.</p>\n<h3 id=\"问题6-程序整体缩放问题\"><a href=\"#问题6-程序整体缩放问题\" class=\"headerlink\" title=\"问题6: 程序整体缩放问题\"></a>问题6: 程序整体缩放问题</h3><p>引用网友的话:</p>\n<blockquote>\n<p>Qt下高分屏的问题，几乎是一场灾难。希望未来 Qt 能有更好的解决方案。</p>\n</blockquote>\n<p>解决方法: 添加 <code>qt/etc/qt.conf</code>文件,注意这是在qrc文件中的路径,它的完整路径是<code>qrc:/qt/etc/qt.conf</code>,网上说一定不要弄错<br>文件内容的意思为不使用QT的缩放功能,而是使用系统的缩放功能</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[Platforms]</span></span><br><span class=\"line\"><span class=\"attr\">WindowsArguments</span> = dpiawareness=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>具体看这个<a href=\"https://github.com/wxydejoy/MoneyProgress_win/commit/76ce3656f6f45008369d1b023bd450f817b59ab3\">commit</a></p>\n<h3 id=\"问题7-QtCreator-无法Debug\"><a href=\"#问题7-QtCreator-无法Debug\" class=\"headerlink\" title=\"问题7: QtCreator 无法Debug\"></a>问题7: QtCreator 无法Debug</h3><p>将build模式从release改为debug就可以了…………………………….</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>项目不大,时间也不算长,大概两三个晚上的样子,但是在这个过程中学到了很多东西,比如说<code>QSettings</code>的使用,<code>QSS</code>的使用,<code>QTimer</code>的使用,<code>QApplication::screenAt(QCursor().pos())-&gt;geometry().width()</code>的使用,以及一些小技巧,比如说<code>QSettings</code>只能在构造函数和析构函数中使用,<code>QSS</code>的<code>border</code>属性要写在<code>centralwidget</code>上,<code>QTimer</code>的<code>start</code>函数可以传入一个参数,表示延迟多久开始计时,<code>QApplication::screenAt(QCursor().pos())-&gt;geometry().width()</code>可以获取鼠标所在屏幕的分辨率宽度等等.</p>\n<p>最后希望大家能够多多支持,如果有什么问题,欢迎指正,可以在评论区留言,我会尽快回复的.</p>\n","categories":[{"name":"💻Code","path":"api/categories/💻Code.json"}],"tags":[{"name":"⏳C++","path":"api/tags/⏳C++.json"},{"name":"⌨️Qt","path":"api/tags/⌨️Qt.json"}]}